{"version":3,"file":"index.js","sources":["../../node_modules/@react-router/dev/dist/config/defaults/entry.server.node.tsx","../../app/root.tsx","../../app/lib/auth/session.ts","../../app/routes/_index.tsx","../../app/lib/db/schema/profile.ts","../../app/lib/db/schema/tweet.ts","../../app/lib/db/schema/like.ts","../../app/lib/db/connection.ts","../../app/models/auth/password.ts","../../app/models/auth/auth.schema.ts","../../app/models/auth/auth.model.ts","../../app/routes/signup.tsx","../../app/lib/security/rate-limit.ts","../../app/routes/login.tsx","../../app/routes/verify-email.tsx","../../app/lib/email/mailgun.ts","../../app/api/handlers/auth.handler.ts","../../app/models/tweet/tweet.schema.ts","../../app/models/tweet/tweet.model.ts","../../app/api/handlers/tweet.handler.ts","../../app/models/like/like.model.ts","../../app/api/handlers/like.handler.ts","../../app/models/user/user.model.ts","../../app/models/user/user.schema.ts","../../app/lib/upload/cloudinary.ts","../../app/api/handlers/profile.handler.ts","../../app/api/router.ts","../../app/routes/api/$.tsx","../../app/routes/_layout.tsx","../../app/components/social/LikeButton.tsx","../../app/components/tweet/TweetFeedItem.tsx","../../app/components/tweet/TweetFeed.tsx","../../app/components/tweet/TweetComposer.tsx","../../app/routes/home.tsx","../../app/routes/compose.tsx","../../app/components/profile/AvatarUpload.tsx","../../app/routes/settings.tsx","../../app/routes/$username.tsx"],"sourcesContent":["import { PassThrough } from \"node:stream\";\n\nimport type { AppLoadContext, EntryContext } from \"react-router\";\nimport { createReadableStreamFromReadable } from \"@react-router/node\";\nimport { ServerRouter } from \"react-router\";\nimport { isbot } from \"isbot\";\nimport type { RenderToPipeableStreamOptions } from \"react-dom/server\";\nimport { renderToPipeableStream } from \"react-dom/server\";\n\nexport const streamTimeout = 5_000;\n\nexport default function handleRequest(\n  request: Request,\n  responseStatusCode: number,\n  responseHeaders: Headers,\n  routerContext: EntryContext,\n  loadContext: AppLoadContext,\n  // If you have middleware enabled:\n  // loadContext: RouterContextProvider\n) {\n  // https://httpwg.org/specs/rfc9110.html#HEAD\n  if (request.method.toUpperCase() === \"HEAD\") {\n    return new Response(null, {\n      status: responseStatusCode,\n      headers: responseHeaders,\n    });\n  }\n\n  return new Promise((resolve, reject) => {\n    let shellRendered = false;\n    let userAgent = request.headers.get(\"user-agent\");\n\n    // Ensure requests from bots and SPA Mode renders wait for all content to load before responding\n    // https://react.dev/reference/react-dom/server/renderToPipeableStream#waiting-for-all-content-to-load-for-crawlers-and-static-generation\n    let readyOption: keyof RenderToPipeableStreamOptions =\n      (userAgent && isbot(userAgent)) || routerContext.isSpaMode\n        ? \"onAllReady\"\n        : \"onShellReady\";\n\n    // Abort the rendering stream after the `streamTimeout` so it has time to\n    // flush down the rejected boundaries\n    let timeoutId: ReturnType<typeof setTimeout> | undefined = setTimeout(\n      () => abort(),\n      streamTimeout + 1000,\n    );\n\n    const { pipe, abort } = renderToPipeableStream(\n      <ServerRouter context={routerContext} url={request.url} />,\n      {\n        [readyOption]() {\n          shellRendered = true;\n          const body = new PassThrough({\n            final(callback) {\n              // Clear the timeout to prevent retaining the closure and memory leak\n              clearTimeout(timeoutId);\n              timeoutId = undefined;\n              callback();\n            },\n          });\n          const stream = createReadableStreamFromReadable(body);\n\n          responseHeaders.set(\"Content-Type\", \"text/html\");\n\n          pipe(body);\n\n          resolve(\n            new Response(stream, {\n              headers: responseHeaders,\n              status: responseStatusCode,\n            }),\n          );\n        },\n        onShellError(error: unknown) {\n          reject(error);\n        },\n        onError(error: unknown) {\n          responseStatusCode = 500;\n          // Log streaming rendering errors from inside the shell.  Don't log\n          // errors encountered during initial shell rendering since they'll\n          // reject and get logged in handleDocumentRequest.\n          if (shellRendered) {\n            console.error(error);\n          }\n        },\n      },\n    );\n  });\n}\n","import {\n  Links,\n  Meta,\n  Outlet,\n  Scripts,\n  ScrollRestoration,\n} from 'react-router';\nimport type { Route } from './+types/root';\n\nimport './tailwind.css';\n\nexport function Layout({ children }: { children: React.ReactNode }) {\n  return (\n    <html lang=\"en\">\n      <head>\n        <meta charSet=\"utf-8\" />\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n        <Meta />\n        <Links />\n      </head>\n      <body className=\"bg-gray-50 min-h-screen\">\n        {children}\n        <ScrollRestoration />\n        <Scripts />\n      </body>\n    </html>\n  );\n}\n\nexport default function Root() {\n  return <Outlet />;\n}\n\nexport function HydrateFallback() {\n  return (\n    <div className=\"flex items-center justify-center min-h-screen\">\n      <div className=\"text-center\">\n        <div className=\"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n        <p className=\"mt-4 text-gray-600\">Loading...</p>\n      </div>\n    </div>\n  );\n}\n","import { createCookieSessionStorage, redirect } from 'react-router';\n\nif (!process.env.SESSION_SECRET) {\n  throw new Error('SESSION_SECRET environment variable is required');\n}\n\n// Create session storage\nexport const sessionStorage = createCookieSessionStorage({\n  cookie: {\n    name: '__session',\n    httpOnly: true,\n    maxAge: 60 * 60 * 24 * 30, // 30 days\n    path: '/',\n    sameSite: 'lax',\n    secrets: [process.env.SESSION_SECRET],\n    secure: process.env.NODE_ENV === 'production',\n  },\n});\n\n/**\n * Create a user session and redirect\n * @param userId - User ID to store in session\n * @param redirectTo - URL to redirect to after login\n */\nexport async function createUserSession(userId: string, redirectTo: string) {\n  const session = await sessionStorage.getSession();\n  session.set('userId', userId);\n\n  return redirect(redirectTo, {\n    headers: {\n      'Set-Cookie': await sessionStorage.commitSession(session),\n    },\n  });\n}\n\n/**\n * Get user ID from session\n * @param request - Request object\n * @returns User ID or null if not authenticated\n */\nexport async function getUserId(request: Request): Promise<string | null> {\n  const session = await sessionStorage.getSession(request.headers.get('Cookie'));\n  const userId = session.get('userId');\n\n  if (!userId || typeof userId !== 'string') {\n    return null;\n  }\n\n  return userId;\n}\n\n/**\n * Require authentication - throws redirect if not authenticated\n * @param request - Request object\n * @returns User ID\n */\nexport async function requireAuth(request: Request): Promise<string> {\n  const userId = await getUserId(request);\n\n  if (!userId) {\n    const url = new URL(request.url);\n    const redirectTo = url.pathname + url.search;\n    throw redirect(`/login?redirectTo=${encodeURIComponent(redirectTo)}`);\n  }\n\n  return userId;\n}\n\n/**\n * Logout user and destroy session\n * @param request - Request object\n */\nexport async function logout(request: Request) {\n  const session = await sessionStorage.getSession(request.headers.get('Cookie'));\n\n  return redirect('/login', {\n    headers: {\n      'Set-Cookie': await sessionStorage.destroySession(session),\n    },\n  });\n}\n","import { redirect } from 'react-router';\nimport { getUserId } from '~/lib/auth/session';\nimport type { Route } from './+types/_index';\n\nexport async function loader({ request }: Route.LoaderArgs) {\n  const userId = await getUserId(request);\n\n  // If already logged in, redirect to home\n  if (userId) {\n    return redirect('/home');\n  }\n\n  return null;\n}\n\nexport default function IndexPage() {\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-500 to-blue-700\">\n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n        <h1 className=\"text-6xl font-extrabold text-white mb-8\">\n          Welcome to Tweeter\n        </h1>\n        <p className=\"text-2xl text-blue-100 mb-12\">\n          Share your thoughts in 140 characters or less\n        </p>\n\n        <div className=\"space-x-4\">\n          <a\n            href=\"/signup\"\n            className=\"inline-block px-8 py-3 bg-white text-blue-600 font-semibold rounded-lg hover:bg-blue-50 transition\"\n          >\n            Sign up\n          </a>\n          <a\n            href=\"/login\"\n            className=\"inline-block px-8 py-3 bg-blue-800 text-white font-semibold rounded-lg hover:bg-blue-900 transition\"\n          >\n            Log in\n          </a>\n        </div>\n\n        <div className=\"mt-16 text-blue-100\">\n          <p className=\"text-lg font-semibold mb-4\">Features:</p>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 text-left\">\n            <div className=\"bg-blue-600 bg-opacity-50 p-6 rounded-lg\">\n              <h3 className=\"font-semibold text-white mb-2\">üìù Quick Tweets</h3>\n              <p className=\"text-sm\">Share your thoughts in 140 characters</p>\n            </div>\n            <div className=\"bg-blue-600 bg-opacity-50 p-6 rounded-lg\">\n              <h3 className=\"font-semibold text-white mb-2\">‚ù§Ô∏è Like & Engage</h3>\n              <p className=\"text-sm\">Show appreciation for great content</p>\n            </div>\n            <div className=\"bg-blue-600 bg-opacity-50 p-6 rounded-lg\">\n              <h3 className=\"font-semibold text-white mb-2\">üë§ Custom Profiles</h3>\n              <p className=\"text-sm\">Personalize your presence with bio and avatar</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { pgTable, uuid, text, timestamp, boolean } from 'drizzle-orm/pg-core';\nimport { uuidv7 } from 'uuidv7';\n\nexport const profiles = pgTable('profiles', {\n  id: uuid('id').primaryKey().$defaultFn(() => uuidv7()),\n  username: text('username').unique().notNull(),\n  email: text('email').unique().notNull(),\n  passwordHash: text('password_hash').notNull(),\n  emailVerified: boolean('email_verified').default(false).notNull(),\n  bio: text('bio'),\n  avatarUrl: text('avatar_url'),\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n});\n\nexport type Profile = typeof profiles.$inferSelect;\nexport type NewProfile = typeof profiles.$inferInsert;\n","import { pgTable, uuid, text, timestamp } from 'drizzle-orm/pg-core';\nimport { uuidv7 } from 'uuidv7';\nimport { profiles } from './profile';\n\nexport const tweets = pgTable('tweets', {\n  id: uuid('id').primaryKey().$defaultFn(() => uuidv7()),\n  profileId: uuid('profile_id')\n    .references(() => profiles.id, { onDelete: 'cascade' })\n    .notNull(),\n  content: text('content').notNull(),\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n});\n\nexport type Tweet = typeof tweets.$inferSelect;\nexport type NewTweet = typeof tweets.$inferInsert;\n","import { pgTable, uuid, timestamp, primaryKey } from 'drizzle-orm/pg-core';\nimport { profiles } from './profile';\nimport { tweets } from './tweet';\n\nexport const likes = pgTable('likes', {\n  tweetId: uuid('tweet_id')\n    .references(() => tweets.id, { onDelete: 'cascade' })\n    .notNull(),\n  profileId: uuid('profile_id')\n    .references(() => profiles.id, { onDelete: 'cascade' })\n    .notNull(),\n  createdAt: timestamp('created_at').defaultNow().notNull(),\n}, (table) => ({\n  pk: primaryKey({ columns: [table.tweetId, table.profileId] }),\n}));\n\nexport type Like = typeof likes.$inferSelect;\nexport type NewLike = typeof likes.$inferInsert;\n","import postgres from 'postgres';\nimport { drizzle } from 'drizzle-orm/postgres-js';\nimport * as schema from './schema';\n\nif (!process.env.DATABASE_URL) {\n  throw new Error('DATABASE_URL environment variable is required');\n}\n\n// Create PostgreSQL connection with pooling\n// Remove channel_binding parameter if present as it can cause connection issues\nconst cleanDatabaseUrl = process.env.DATABASE_URL.replace(/[&?]channel_binding=[^&]*/g, '');\n\nconst sql = postgres(cleanDatabaseUrl, {\n  max: 20,\n  idle_timeout: 20,\n  connect_timeout: 30, // Increased from 10 to 30 seconds\n  connection: {\n    application_name: 'tweeter',\n  },\n});\n\n// Create Drizzle instance\nexport const db = drizzle(sql, { schema });\n\nexport default db;\n","import { hash, verify } from '@node-rs/argon2';\n\n/**\n * Hash a password using Argon2id\n * @param password - Plain text password to hash\n * @returns Hashed password\n */\nexport async function hashPassword(password: string): Promise<string> {\n  return hash(password, {\n    memoryCost: 65536, // 64MB\n    timeCost: 3,\n    outputLen: 32,\n    parallelism: 1,\n  });\n}\n\n/**\n * Verify a password against its hash\n * @param hash - Stored password hash\n * @param password - Plain text password to verify\n * @returns True if password matches, false otherwise\n */\nexport async function verifyPassword(hash: string, password: string): Promise<boolean> {\n  try {\n    return await verify(hash, password);\n  } catch {\n    return false;\n  }\n}\n","import { z } from 'zod';\n\nexport const signupSchema = z.object({\n  username: z\n    .string()\n    .min(3, 'Username must be at least 3 characters')\n    .max(20, 'Username must be at most 20 characters')\n    .regex(/^[a-zA-Z0-9_]+$/, 'Username can only contain letters, numbers, and underscores'),\n  email: z\n    .string()\n    .email('Invalid email address'),\n  password: z\n    .string()\n    .min(8, 'Password must be at least 8 characters'),\n});\n\nexport const loginSchema = z.object({\n  email: z\n    .string()\n    .email('Invalid email address'),\n  password: z\n    .string()\n    .min(8, 'Password must be at least 8 characters'),\n});\n\nexport const verifyEmailSchema = z.object({\n  token: z.string(),\n});\n\nexport type SignupData = z.infer<typeof signupSchema>;\nexport type LoginData = z.infer<typeof loginSchema>;\nexport type VerifyEmailData = z.infer<typeof verifyEmailSchema>;\n","import { eq } from 'drizzle-orm';\nimport { SignJWT } from 'jose';\nimport db from '~/lib/db/connection';\nimport { profiles } from '~/lib/db/schema';\nimport { hashPassword, verifyPassword } from './password';\nimport { signupSchema, loginSchema, type SignupData, type LoginData } from './auth.schema';\n\n/**\n * Sign up a new user\n * @param data - User registration data\n * @returns User ID and verification token\n */\nexport async function signupUser(data: SignupData): Promise<{ userId: string; verificationToken: string }> {\n  // Validate input\n  const validated = signupSchema.parse(data);\n\n  // Check if username already exists\n  const existingUsername = await db.query.profiles.findFirst({\n    where: eq(profiles.username, validated.username),\n  });\n\n  if (existingUsername) {\n    throw new Error('Username already taken');\n  }\n\n  // Check if email already exists\n  const existingEmail = await db.query.profiles.findFirst({\n    where: eq(profiles.email, validated.email),\n  });\n\n  if (existingEmail) {\n    throw new Error('Email already registered');\n  }\n\n  // Hash password\n  const passwordHash = await hashPassword(validated.password);\n\n  // Insert new user\n  const [user] = await db\n    .insert(profiles)\n    .values({\n      username: validated.username,\n      email: validated.email,\n      passwordHash,\n      emailVerified: false,\n    })\n    .returning();\n\n  // Generate verification token (JWT, 24hr expiry)\n  const secret = new TextEncoder().encode(process.env.JWT_SECRET);\n  const verificationToken = await new SignJWT({ userId: user.id, email: user.email })\n    .setProtectedHeader({ alg: 'HS256' })\n    .setExpirationTime('24h')\n    .setIssuedAt()\n    .sign(secret);\n\n  return {\n    userId: user.id,\n    verificationToken,\n  };\n}\n\n/**\n * Verify user email with token\n * @param token - JWT verification token\n */\nexport async function verifyEmail(token: string): Promise<void> {\n  try {\n    // Verify and decode JWT\n    const secret = new TextEncoder().encode(process.env.JWT_SECRET);\n    const { jwtVerify } = await import('jose');\n    const { payload } = await jwtVerify(token, secret);\n\n    if (!payload.userId || typeof payload.userId !== 'string') {\n      throw new Error('Invalid token payload');\n    }\n\n    // Mark user as verified\n    await db\n      .update(profiles)\n      .set({ emailVerified: true })\n      .where(eq(profiles.id, payload.userId));\n  } catch (error) {\n    throw new Error('Invalid or expired verification token');\n  }\n}\n\n/**\n * Authenticate user with email and password\n * @param email - User email\n * @param password - User password\n * @returns User object if authenticated, null otherwise\n */\nexport async function authenticateUser(email: string, password: string): Promise<typeof profiles.$inferSelect | null> {\n  // Validate input\n  const validated = loginSchema.parse({ email, password });\n\n  // Find user by email\n  const user = await db.query.profiles.findFirst({\n    where: eq(profiles.email, validated.email),\n  });\n\n  if (!user) {\n    return null;\n  }\n\n  // Verify password\n  const isValid = await verifyPassword(user.passwordHash, validated.password);\n\n  if (!isValid) {\n    return null;\n  }\n\n  // Check if email is verified\n  if (!user.emailVerified) {\n    throw new Error('Email not verified. Please check your email for verification link.');\n  }\n\n  return user;\n}\n","import { useState } from 'react';\nimport { Form, redirect, useActionData, useNavigation } from 'react-router';\nimport type { Route } from './+types/signup';\nimport { signupUser } from '~/models/auth/auth.model';\n\nexport async function action({ request }: Route.ActionArgs) {\n  const formData = await request.formData();\n  const username = formData.get('username') as string;\n  const email = formData.get('email') as string;\n  const password = formData.get('password') as string;\n\n  try {\n    await signupUser({ username, email, password });\n    return redirect('/login?verified=pending');\n  } catch (error) {\n    return { error: error instanceof Error ? error.message : 'Failed to create account' };\n  }\n}\n\nexport default function SignupPage() {\n  const actionData = useActionData<typeof action>();\n  const navigation = useNavigation();\n  const isSubmitting = navigation.state === 'submitting';\n\n  const [password, setPassword] = useState('');\n  const [confirmPassword, setConfirmPassword] = useState('');\n\n  // Calculate if passwords match (both must have values and be equal)\n  const passwordsMatch = password.length > 0 && password === confirmPassword;\n  const showPasswordMismatch = confirmPassword.length > 0 && password !== confirmPassword;\n  const isFormValid = password.length >= 8 && passwordsMatch;\n\n  const handlePasswordChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setPassword(e.target.value);\n  };\n\n  const handleConfirmPasswordChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setConfirmPassword(e.target.value);\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8\">\n      <div className=\"max-w-md w-full space-y-8\">\n        <div>\n          <h1 className=\"text-center text-3xl font-extrabold text-gray-900\">\n            Create your account\n          </h1>\n          <p className=\"mt-2 text-center text-sm text-gray-600\">\n            Join Tweeter and start sharing\n          </p>\n        </div>\n\n        <Form method=\"post\" className=\"mt-8 space-y-6\">\n          {actionData?.error && (\n            <div className=\"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded\">\n              {actionData.error}\n            </div>\n          )}\n\n          <div className=\"space-y-4\">\n            <div>\n              <label htmlFor=\"username\" className=\"block text-sm font-medium text-gray-700\">\n                Username\n              </label>\n              <input\n                id=\"username\"\n                name=\"username\"\n                type=\"text\"\n                required\n                minLength={3}\n                maxLength={20}\n                pattern=\"[a-zA-Z0-9_]+\"\n                className=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500\"\n                placeholder=\"johndoe\"\n              />\n              <p className=\"mt-1 text-xs text-gray-500\">\n                3-20 characters, letters, numbers, and underscores only\n              </p>\n            </div>\n\n            <div>\n              <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700\">\n                Email address\n              </label>\n              <input\n                id=\"email\"\n                name=\"email\"\n                type=\"email\"\n                required\n                className=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500\"\n                placeholder=\"you@example.com\"\n              />\n            </div>\n\n            <div>\n              <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-700\">\n                Password\n              </label>\n              <input\n                id=\"password\"\n                name=\"password\"\n                type=\"password\"\n                required\n                minLength={8}\n                value={password}\n                onChange={handlePasswordChange}\n                className=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500\"\n                placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\n              />\n              <p className=\"mt-1 text-xs text-gray-500\">At least 8 characters</p>\n            </div>\n\n            <div>\n              <label htmlFor=\"confirm-password\" className=\"block text-sm font-medium text-gray-700\">\n                Confirm password\n              </label>\n              <input\n                id=\"confirm-password\"\n                type=\"password\"\n                required\n                value={confirmPassword}\n                onChange={handleConfirmPasswordChange}\n                className={`mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${\n                  showPasswordMismatch ? 'border-red-300' : 'border-gray-300'\n                }`}\n                placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\n              />\n              {showPasswordMismatch && (\n                <p className=\"mt-1 text-xs text-red-600\">Passwords do not match</p>\n              )}\n            </div>\n          </div>\n\n          <button\n            type=\"submit\"\n            disabled={isSubmitting || !isFormValid}\n            className=\"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            {isSubmitting ? 'Creating account...' : 'Sign up'}\n          </button>\n\n          <p className=\"text-center text-sm text-gray-600\">\n            Already have an account?{' '}\n            <a href=\"/login\" className=\"font-medium text-blue-600 hover:text-blue-500\">\n              Log in\n            </a>\n          </p>\n        </Form>\n      </div>\n    </div>\n  );\n}\n","interface RateLimitOptions {\n  max: number; // Maximum requests\n  window: number; // Time window in milliseconds\n}\n\ninterface RateLimitEntry {\n  count: number;\n  resetTime: number;\n}\n\n// In-memory storage (for production, use Redis or similar)\nconst rateLimitStore = new Map<string, RateLimitEntry>();\n\n/**\n * Create a rate limiter function\n * @param options - Rate limit configuration\n * @returns Rate limiter function\n */\nexport function createRateLimiter(options: RateLimitOptions) {\n  return async (identifier: string): Promise<{ allowed: boolean; remaining: number; resetTime: number }> => {\n    const now = Date.now();\n    const entry = rateLimitStore.get(identifier);\n\n    // Clean up expired entries\n    if (entry && entry.resetTime < now) {\n      rateLimitStore.delete(identifier);\n    }\n\n    // Get or create entry\n    const current = rateLimitStore.get(identifier) || {\n      count: 0,\n      resetTime: now + options.window,\n    };\n\n    // Check if allowed\n    if (current.count >= options.max) {\n      return {\n        allowed: false,\n        remaining: 0,\n        resetTime: current.resetTime,\n      };\n    }\n\n    // Increment count\n    current.count++;\n    rateLimitStore.set(identifier, current);\n\n    return {\n      allowed: true,\n      remaining: options.max - current.count,\n      resetTime: current.resetTime,\n    };\n  };\n}\n\n// Pre-configured rate limiters\nexport const loginRateLimiter = createRateLimiter({\n  max: 5,\n  window: 15 * 60 * 1000, // 15 minutes\n});\n\nexport const signupRateLimiter = createRateLimiter({\n  max: 3,\n  window: 60 * 60 * 1000, // 1 hour\n});\n\nexport const tweetRateLimiter = createRateLimiter({\n  max: 10,\n  window: 60 * 1000, // 1 minute\n});\n\n/**\n * Get client IP from request\n * @param request - Request object\n * @returns Client IP address\n */\nexport function getClientIp(request: Request): string {\n  const forwarded = request.headers.get('x-forwarded-for');\n  if (forwarded) {\n    return forwarded.split(',')[0].trim();\n  }\n  return request.headers.get('x-real-ip') || 'unknown';\n}\n","import { Form, useActionData, useNavigation, useSearchParams } from 'react-router';\nimport { authenticateUser } from '~/models/auth/auth.model';\nimport { createUserSession } from '~/lib/auth/session';\nimport { loginRateLimiter, getClientIp } from '~/lib/security/rate-limit';\nimport type { Route } from './+types/login';\n\nexport async function action({ request }: Route.ActionArgs) {\n  const formData = await request.formData();\n  const email = formData.get('email') as string;\n  const password = formData.get('password') as string;\n  const redirectTo = (formData.get('redirectTo') as string) || '/home';\n\n  try {\n    // Rate limiting\n    const clientIp = getClientIp(request);\n    const rateLimit = await loginRateLimiter(clientIp);\n\n    if (!rateLimit.allowed) {\n      return { error: 'Too many login attempts. Please try again later.' };\n    }\n\n    // Authenticate user\n    const user = await authenticateUser(email, password);\n\n    if (!user) {\n      return { error: 'Invalid email or password' };\n    }\n\n    // Create session and redirect\n    return await createUserSession(user.id, redirectTo);\n  } catch (error) {\n    if (error instanceof Error) {\n      return { error: error.message };\n    }\n    return { error: 'Failed to login' };\n  }\n}\n\nexport default function LoginPage() {\n  const actionData = useActionData<typeof action>();\n  const navigation = useNavigation();\n  const [searchParams] = useSearchParams();\n  const isSubmitting = navigation.state === 'submitting';\n\n  const verificationPending = searchParams.get('verified') === 'pending';\n  const redirectTo = searchParams.get('redirectTo') || '/home';\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8\">\n      <div className=\"max-w-md w-full space-y-8\">\n        <div>\n          <h1 className=\"text-center text-3xl font-extrabold text-gray-900\">\n            Log in to Tweeter\n          </h1>\n          <p className=\"mt-2 text-center text-sm text-gray-600\">\n            Welcome back!\n          </p>\n        </div>\n\n        {verificationPending && (\n          <div className=\"bg-blue-50 border border-blue-200 text-blue-800 px-4 py-3 rounded\">\n            Please check your email and click the verification link to activate your account.\n          </div>\n        )}\n\n        <Form method=\"post\" className=\"mt-8 space-y-6\">\n          <input type=\"hidden\" name=\"redirectTo\" value={redirectTo} />\n\n          {actionData?.error && (\n            <div className=\"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded\">\n              {actionData.error}\n            </div>\n          )}\n\n          <div className=\"space-y-4\">\n            <div>\n              <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700\">\n                Email address\n              </label>\n              <input\n                id=\"email\"\n                name=\"email\"\n                type=\"email\"\n                required\n                autoComplete=\"email\"\n                className=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500\"\n                placeholder=\"you@example.com\"\n              />\n            </div>\n\n            <div>\n              <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-700\">\n                Password\n              </label>\n              <input\n                id=\"password\"\n                name=\"password\"\n                type=\"password\"\n                required\n                autoComplete=\"current-password\"\n                className=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500\"\n                placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\n              />\n            </div>\n          </div>\n\n          <button\n            type=\"submit\"\n            disabled={isSubmitting}\n            className=\"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            {isSubmitting ? 'Logging in...' : 'Log in'}\n          </button>\n\n          <p className=\"text-center text-sm text-gray-600\">\n            Don't have an account?{' '}\n            <a href=\"/signup\" className=\"font-medium text-blue-600 hover:text-blue-500\">\n              Sign up\n            </a>\n          </p>\n        </Form>\n      </div>\n    </div>\n  );\n}\n","import { Link } from 'react-router';\nimport type { Route } from './+types/verify-email';\nimport { verifyEmail } from '~/models/auth/auth.model';\n\nexport async function loader({ request }: Route.LoaderArgs) {\n  const url = new URL(request.url);\n  const token = url.searchParams.get('token');\n\n  if (!token) {\n    return { success: false, error: 'No verification token provided' };\n  }\n\n  try {\n    // Verify the email directly\n    await verifyEmail(token);\n    return { success: true, message: 'Email verified successfully. You can now log in.' };\n  } catch (error) {\n    const errorMessage = error instanceof Error ? error.message : 'Failed to verify email';\n    return { success: false, error: errorMessage };\n  }\n}\n\nexport default function VerifyEmail({ loaderData }: Route.ComponentProps) {\n  const { success, error, message } = loaderData;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center px-4\">\n      <div className=\"max-w-md w-full bg-white rounded-lg shadow-md p-8\">\n        <div className=\"text-center\">\n          {success ? (\n            <>\n              <div className=\"mb-4\">\n                <svg\n                  className=\"mx-auto h-16 w-16 text-green-500\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                    d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\n                  />\n                </svg>\n              </div>\n              <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">\n                Email Verified!\n              </h1>\n              <p className=\"text-gray-600 mb-6\">{message}</p>\n              <Link\n                to=\"/login\"\n                className=\"inline-block bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition\"\n              >\n                Go to Login\n              </Link>\n            </>\n          ) : (\n            <>\n              <div className=\"mb-4\">\n                <svg\n                  className=\"mx-auto h-16 w-16 text-red-500\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                    d=\"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z\"\n                  />\n                </svg>\n              </div>\n              <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">\n                Verification Failed\n              </h1>\n              <p className=\"text-gray-600 mb-6\">{error}</p>\n              <div className=\"space-y-3\">\n                <Link\n                  to=\"/signup\"\n                  className=\"block bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition\"\n                >\n                  Sign Up Again\n                </Link>\n                <Link\n                  to=\"/login\"\n                  className=\"block text-blue-500 hover:text-blue-600 transition\"\n                >\n                  Back to Login\n                </Link>\n              </div>\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","import Mailgun from 'mailgun.js';\nimport FormData from 'form-data';\n\nif (!process.env.MAILGUN_API_KEY || !process.env.MAILGUN_DOMAIN) {\n  throw new Error('MAILGUN_API_KEY and MAILGUN_DOMAIN environment variables are required');\n}\n\nconst mailgun = new Mailgun(FormData);\nconst mg = mailgun.client({\n  username: 'api',\n  key: process.env.MAILGUN_API_KEY,\n});\n\n/**\n * Send email verification link to user\n * @param email - Recipient email address\n * @param token - Verification token\n * @param baseUrl - Base URL of the application (optional, will use BASE_URL env var or default)\n */\nexport async function sendVerificationEmail(email: string, token: string, baseUrl?: string): Promise<void> {\n  const verificationUrl = `${baseUrl || process.env.BASE_URL || 'http://localhost:5173'}/verify-email?token=${token}`;\n\n  const fromEmail = process.env.MAILGUN_FROM_EMAIL || `noreply@${process.env.MAILGUN_DOMAIN}`;\n  const fromName = process.env.MAILGUN_FROM_NAME || 'Tweeter';\n\n  try {\n    await mg.messages.create(process.env.MAILGUN_DOMAIN!, {\n      from: `${fromName} <${fromEmail}>`,\n      to: [email],\n      subject: 'Verify your Tweeter account',\n      html: `\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <meta charset=\"utf-8\">\n          <style>\n            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n            .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n            .button { display: inline-block; padding: 12px 24px; background-color: #1DA1F2; color: white; text-decoration: none; border-radius: 4px; margin: 20px 0; }\n            .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #eee; font-size: 12px; color: #666; }\n          </style>\n        </head>\n        <body>\n          <div class=\"container\">\n            <h1>Welcome to Tweeter!</h1>\n            <p>Thank you for signing up. Please verify your email address to activate your account.</p>\n            <a href=\"${verificationUrl}\" class=\"button\">Verify Email Address</a>\n            <p>Or copy and paste this link into your browser:</p>\n            <p style=\"word-break: break-all;\">${verificationUrl}</p>\n            <p><strong>This link will expire in 24 hours.</strong></p>\n            <div class=\"footer\">\n              <p>If you didn't create an account, you can safely ignore this email.</p>\n            </div>\n          </div>\n        </body>\n        </html>\n      `,\n      text: `\n        Welcome to Tweeter!\n\n        Thank you for signing up. Please verify your email address to activate your account.\n\n        Click here to verify: ${verificationUrl}\n\n        This link will expire in 24 hours.\n\n        If you didn't create an account, you can safely ignore this email.\n      `,\n    });\n  } catch (error) {\n    console.error('Failed to send verification email:', error);\n    throw new Error('Failed to send verification email');\n  }\n}\n","\nimport { signupUser, authenticateUser, verifyEmail } from '~/models/auth/auth.model';\nimport { createUserSession, logout } from '~/lib/auth/session';\nimport { sendVerificationEmail } from '~/lib/email/mailgun';\nimport { signupRateLimiter, loginRateLimiter, getClientIp } from '~/lib/security/rate-limit';\n\n/**\n * Handle user signup\n * POST /api/auth/signup\n */\nexport async function handleSignup(request: Request): Promise<Response> {\n  try {\n    // Rate limiting\n    const clientIp = getClientIp(request);\n    const rateLimit = await signupRateLimiter(clientIp);\n\n    if (!rateLimit.allowed) {\n      return Response.json(\n        { error: 'Too many signup attempts. Please try again later.' },\n        { status: 429 }\n      );\n    }\n\n    // Parse request body\n    const body = await request.json();\n\n    // Create user\n    const { userId, verificationToken } = await signupUser(body);\n\n    // Send verification email (non-fatal - don't fail signup if email fails)\n    try {\n      // Get base URL from request\n      const url = new URL(request.url);\n      const baseUrl = `${url.protocol}//${url.host}`;\n      await sendVerificationEmail(body.email, verificationToken, baseUrl);\n    } catch (emailError) {\n      console.error('Failed to send verification email:', emailError);\n      // Continue with signup even if email fails\n    }\n\n    return Response.json(\n      {\n        message: 'Account created. Please check your email to verify.',\n        userId,\n      },\n      { status: 201 }\n    );\n  } catch (error) {\n    if (error instanceof Error) {\n      return Response.json({ error: error.message }, { status: 400 });\n    }\n    return Response.json({ error: 'Failed to create account' }, { status: 500 });\n  }\n}\n\n/**\n * Handle user login\n * POST /api/auth/login\n */\nexport async function handleLogin(request: Request): Promise<Response> {\n  try {\n    // Rate limiting\n    const clientIp = getClientIp(request);\n    const rateLimit = await loginRateLimiter(clientIp);\n\n    if (!rateLimit.allowed) {\n      return Response.json(\n        { error: 'Too many login attempts. Please try again later.' },\n        { status: 429 }\n      );\n    }\n\n    // Parse request body\n    const body = await request.json();\n    const { email, password } = body;\n\n    // Authenticate user\n    const user = await authenticateUser(email, password);\n\n    if (!user) {\n      return Response.json({ error: 'Invalid email or password' }, { status: 401 });\n    }\n\n    // Create session and redirect\n    const redirectTo = new URL(request.url).searchParams.get('redirectTo') || '/home';\n    return await createUserSession(user.id, redirectTo);\n  } catch (error) {\n    if (error instanceof Error) {\n      return Response.json({ error: error.message }, { status: 400 });\n    }\n    return Response.json({ error: 'Failed to login' }, { status: 500 });\n  }\n}\n\n/**\n * Handle user logout\n * POST /api/auth/logout\n */\nexport async function handleLogout(request: Request): Promise<Response> {\n  return await logout(request);\n}\n\n/**\n * Handle email verification\n * GET /api/auth/verify?token=xxx\n */\nexport async function handleVerifyEmail(request: Request): Promise<Response> {\n  try {\n    const url = new URL(request.url);\n    const token = url.searchParams.get('token');\n\n    if (!token) {\n      return Response.json({ error: 'Verification token is required' }, { status: 400 });\n    }\n\n    await verifyEmail(token);\n\n    return Response.json({ message: 'Email verified successfully. You can now log in.' });\n  } catch (error) {\n    if (error instanceof Error) {\n      return Response.json({ error: error.message }, { status: 400 });\n    }\n    return Response.json({ error: 'Failed to verify email' }, { status: 500 });\n  }\n}\n","import { z } from 'zod';\n\nexport const tweetSchema = z.object({\n  content: z\n    .string()\n    .min(1, 'Tweet cannot be empty')\n    .max(140, 'Tweet cannot exceed 140 characters'),\n});\n\nexport type TweetData = z.infer<typeof tweetSchema>;\n","import { eq, desc } from 'drizzle-orm';\nimport db from '~/lib/db/connection';\nimport { tweets, profiles } from '~/lib/db/schema';\nimport { tweetSchema, type TweetData } from './tweet.schema';\n\nexport interface TweetWithAuthor {\n  id: string;\n  content: string;\n  createdAt: Date;\n  profileId: string;\n  author: {\n    id: string;\n    username: string;\n    avatarUrl: string | null;\n  };\n  likeCount?: number;\n  isLiked?: boolean;\n}\n\n/**\n * Create a new tweet\n * @param profileId - ID of the user creating the tweet\n * @param data - Tweet data\n * @returns Created tweet\n */\nexport async function createTweet(profileId: string, data: TweetData) {\n  // Validate content\n  const validated = tweetSchema.parse(data);\n\n  // Insert tweet\n  const [tweet] = await db\n    .insert(tweets)\n    .values({\n      profileId,\n      content: validated.content,\n    })\n    .returning();\n\n  return tweet;\n}\n\n/**\n * Get global tweet feed (all tweets, newest first)\n * @param limit - Maximum number of tweets to return\n * @param offset - Number of tweets to skip\n * @returns Array of tweets with author information\n */\nexport async function getFeed(limit = 20, offset = 0): Promise<TweetWithAuthor[]> {\n  const results = await db\n    .select({\n      id: tweets.id,\n      content: tweets.content,\n      createdAt: tweets.createdAt,\n      profileId: tweets.profileId,\n      author: {\n        id: profiles.id,\n        username: profiles.username,\n        avatarUrl: profiles.avatarUrl,\n      },\n    })\n    .from(tweets)\n    .innerJoin(profiles, eq(tweets.profileId, profiles.id))\n    .orderBy(desc(tweets.createdAt))\n    .limit(limit)\n    .offset(offset);\n\n  return results;\n}\n\n/**\n * Get tweets by a specific user\n * @param userId - User ID\n * @param limit - Maximum number of tweets to return\n * @param offset - Number of tweets to skip\n * @returns Array of user's tweets\n */\nexport async function getTweetsByUserId(userId: string, limit = 20, offset = 0): Promise<TweetWithAuthor[]> {\n  const results = await db\n    .select({\n      id: tweets.id,\n      content: tweets.content,\n      createdAt: tweets.createdAt,\n      profileId: tweets.profileId,\n      author: {\n        id: profiles.id,\n        username: profiles.username,\n        avatarUrl: profiles.avatarUrl,\n      },\n    })\n    .from(tweets)\n    .innerJoin(profiles, eq(tweets.profileId, profiles.id))\n    .where(eq(tweets.profileId, userId))\n    .orderBy(desc(tweets.createdAt))\n    .limit(limit)\n    .offset(offset);\n\n  return results;\n}\n\n/**\n * Get a single tweet by ID\n * @param tweetId - Tweet ID\n * @returns Tweet with author information or null\n */\nexport async function getTweetById(tweetId: string): Promise<TweetWithAuthor | null> {\n  const results = await db\n    .select({\n      id: tweets.id,\n      content: tweets.content,\n      createdAt: tweets.createdAt,\n      profileId: tweets.profileId,\n      author: {\n        id: profiles.id,\n        username: profiles.username,\n        avatarUrl: profiles.avatarUrl,\n      },\n    })\n    .from(tweets)\n    .innerJoin(profiles, eq(tweets.profileId, profiles.id))\n    .where(eq(tweets.id, tweetId))\n    .limit(1);\n\n  return results[0] || null;\n}\n\n/**\n * Delete a tweet\n * @param tweetId - Tweet ID\n * @param userId - ID of the user attempting to delete\n * @returns True if deleted, false if tweet not found or user not authorized\n */\nexport async function deleteTweet(tweetId: string, userId: string): Promise<boolean> {\n  // First, verify the tweet exists and belongs to the user\n  const tweet = await db\n    .select({\n      id: tweets.id,\n      profileId: tweets.profileId,\n    })\n    .from(tweets)\n    .where(eq(tweets.id, tweetId))\n    .limit(1);\n\n  if (tweet.length === 0) {\n    return false; // Tweet not found\n  }\n\n  if (tweet[0].profileId !== userId) {\n    return false; // User is not the author\n  }\n\n  // Delete the tweet (likes will be cascade deleted by DB)\n  await db.delete(tweets).where(eq(tweets.id, tweetId));\n\n  return true;\n}\n","\nimport { createTweet, getFeed, getTweetsByUserId, deleteTweet } from '~/models/tweet/tweet.model';\nimport { requireAuth } from '~/lib/auth/session';\nimport { tweetRateLimiter, getClientIp } from '~/lib/security/rate-limit';\n\n/**\n * Handle tweet creation\n * POST /api/tweets\n */\nexport async function handleCreateTweet(request: Request): Promise<Response> {\n  try {\n    // Require authentication\n    const userId = await requireAuth(request);\n\n    // Rate limiting\n    const clientIp = getClientIp(request);\n    const rateLimit = await tweetRateLimiter(clientIp);\n\n    if (!rateLimit.allowed) {\n      return Response.json(\n        { error: 'Too many tweets. Please slow down.' },\n        { status: 429 }\n      );\n    }\n\n    // Parse request body\n    const body = await request.json();\n\n    // Create tweet\n    const tweet = await createTweet(userId, body);\n\n    return Response.json(tweet, { status: 201 });\n  } catch (error) {\n    if (error instanceof Error) {\n      return Response.json({ error: error.message }, { status: 400 });\n    }\n    return Response.json({ error: 'Failed to create tweet' }, { status: 500 });\n  }\n}\n\n/**\n * Handle feed fetch\n * GET /api/tweets?limit=20&offset=0\n */\nexport async function handleGetFeed(request: Request): Promise<Response> {\n  try {\n    const url = new URL(request.url);\n    const limit = parseInt(url.searchParams.get('limit') || '20', 10);\n    const offset = parseInt(url.searchParams.get('offset') || '0', 10);\n\n    const tweets = await getFeed(limit, offset);\n\n    return Response.json({ tweets });\n  } catch (error) {\n    return Response.json({ error: 'Failed to fetch feed' }, { status: 500 });\n  }\n}\n\n/**\n * Handle user tweets fetch\n * GET /api/tweets/user/:userId\n */\nexport async function handleGetUserTweets(request: Request, userId: string): Promise<Response> {\n  try {\n    const url = new URL(request.url);\n    const limit = parseInt(url.searchParams.get('limit') || '20', 10);\n    const offset = parseInt(url.searchParams.get('offset') || '0', 10);\n\n    const tweets = await getTweetsByUserId(userId, limit, offset);\n\n    return Response.json({ tweets });\n  } catch (error) {\n    return Response.json({ error: 'Failed to fetch tweets' }, { status: 500 });\n  }\n}\n\n/**\n * Handle tweet deletion\n * DELETE /api/tweets/:tweetId\n */\nexport async function handleDeleteTweet(request: Request, tweetId: string): Promise<Response> {\n  try {\n    // Require authentication\n    const userId = await requireAuth(request);\n\n    // Attempt to delete the tweet\n    const deleted = await deleteTweet(tweetId, userId);\n\n    if (!deleted) {\n      return Response.json(\n        { error: 'Tweet not found or you are not authorized to delete it' },\n        { status: 404 }\n      );\n    }\n\n    return Response.json({ success: true, message: 'Tweet deleted successfully' });\n  } catch (error) {\n    if (error instanceof Error) {\n      return Response.json({ error: error.message }, { status: 400 });\n    }\n    return Response.json({ error: 'Failed to delete tweet' }, { status: 500 });\n  }\n}\n","import { eq, and, count } from 'drizzle-orm';\nimport { db } from '~/lib/db/connection';\nimport { likes, tweets } from '~/lib/db/schema';\n\n/**\n * Toggle like on a tweet\n * @param tweetId - Tweet ID\n * @param userId - User ID\n * @returns true if liked, false if unliked\n */\nexport async function toggleLike(tweetId: string, userId: string): Promise<boolean> {\n  // Check if like already exists\n  const existingLike = await db\n    .select()\n    .from(likes)\n    .where(and(eq(likes.tweetId, tweetId), eq(likes.profileId, userId)))\n    .limit(1);\n\n  if (existingLike.length > 0) {\n    // Unlike: Delete the like\n    await db\n      .delete(likes)\n      .where(and(eq(likes.tweetId, tweetId), eq(likes.profileId, userId)));\n    return false;\n  } else {\n    // Like: Insert the like\n    await db.insert(likes).values({\n      tweetId,\n      profileId: userId,\n    });\n    return true;\n  }\n}\n\n/**\n * Check if a user has liked a tweet\n * @param tweetId - Tweet ID\n * @param userId - User ID\n * @returns true if liked, false otherwise\n */\nexport async function isLikedByUser(tweetId: string, userId: string): Promise<boolean> {\n  const result = await db\n    .select()\n    .from(likes)\n    .where(and(eq(likes.tweetId, tweetId), eq(likes.profileId, userId)))\n    .limit(1);\n\n  return result.length > 0;\n}\n\n/**\n * Get like count for a tweet\n * @param tweetId - Tweet ID\n * @returns Number of likes\n */\nexport async function getLikeCount(tweetId: string): Promise<number> {\n  const result = await db\n    .select({ count: count() })\n    .from(likes)\n    .where(eq(likes.tweetId, tweetId));\n\n  return result[0]?.count ?? 0;\n}\n\n/**\n * Get like counts for multiple tweets\n * @param tweetIds - Array of tweet IDs\n * @returns Map of tweetId to like count\n */\nexport async function getLikeCounts(tweetIds: string[]): Promise<Map<string, number>> {\n  if (tweetIds.length === 0) {\n    return new Map();\n  }\n\n  const results = await db\n    .select({\n      tweetId: likes.tweetId,\n      count: count(),\n    })\n    .from(likes)\n    .where(\n      eq(\n        likes.tweetId,\n        tweetIds[0] // Note: This needs to be updated to use IN clause for multiple IDs\n      )\n    )\n    .groupBy(likes.tweetId);\n\n  const likeCounts = new Map<string, number>();\n  for (const result of results) {\n    likeCounts.set(result.tweetId, result.count);\n  }\n\n  // Fill in 0 for tweets with no likes\n  for (const tweetId of tweetIds) {\n    if (!likeCounts.has(tweetId)) {\n      likeCounts.set(tweetId, 0);\n    }\n  }\n\n  return likeCounts;\n}\n\n/**\n * Get tweets liked by a user\n * @param userId - User ID\n * @param limit - Maximum number to return\n * @param offset - Number to skip\n * @returns Array of tweet IDs\n */\nexport async function getLikedTweetIds(\n  userId: string,\n  limit = 20,\n  offset = 0\n): Promise<string[]> {\n  const results = await db\n    .select({ tweetId: likes.tweetId })\n    .from(likes)\n    .where(eq(likes.profileId, userId))\n    .limit(limit)\n    .offset(offset);\n\n  return results.map((r) => r.tweetId);\n}\n","\nimport { toggleLike, getLikeCount, isLikedByUser } from '~/models/like/like.model';\nimport { requireAuth } from '~/lib/auth/session';\n\n/**\n * Handle like toggle\n * POST /api/likes/:tweetId\n */\nexport async function handleToggleLike(request: Request, tweetId: string): Promise<Response> {\n  try {\n    // Require authentication\n    const userId = await requireAuth(request);\n\n    // Toggle the like\n    const liked = await toggleLike(tweetId, userId);\n\n    // Get updated like count\n    const likeCount = await getLikeCount(tweetId);\n\n    return Response.json({\n      success: true,\n      liked,\n      likeCount,\n      message: liked ? 'Tweet liked' : 'Tweet unliked',\n    });\n  } catch (error) {\n    if (error instanceof Error) {\n      return Response.json({ error: error.message }, { status: 400 });\n    }\n    return Response.json({ error: 'Failed to toggle like' }, { status: 500 });\n  }\n}\n\n/**\n * Handle get like status\n * GET /api/likes/:tweetId\n */\nexport async function handleGetLikeStatus(\n  request: Request,\n  tweetId: string\n): Promise<Response> {\n  try {\n    // Get user ID (optional auth)\n    const userId = await requireAuth(request).catch(() => null);\n\n    // Get like count\n    const likeCount = await getLikeCount(tweetId);\n\n    // Check if current user has liked (if authenticated)\n    let liked = false;\n    if (userId) {\n      liked = await isLikedByUser(tweetId, userId);\n    }\n\n    return Response.json({\n      likeCount,\n      liked,\n    });\n  } catch (error) {\n    return Response.json({ error: 'Failed to fetch like status' }, { status: 500 });\n  }\n}\n","import { eq } from 'drizzle-orm';\nimport { db } from '~/lib/db/connection';\nimport { profiles } from '~/lib/db/schema';\n\nexport interface PublicProfile {\n  id: string;\n  username: string;\n  bio: string | null;\n  avatarUrl: string | null;\n  createdAt: Date;\n}\n\n/**\n * Get user by ID\n * @param userId - User ID\n * @returns Public profile or null\n */\nexport async function getUserById(userId: string): Promise<PublicProfile | null> {\n  const results = await db\n    .select({\n      id: profiles.id,\n      username: profiles.username,\n      bio: profiles.bio,\n      avatarUrl: profiles.avatarUrl,\n      createdAt: profiles.createdAt,\n    })\n    .from(profiles)\n    .where(eq(profiles.id, userId))\n    .limit(1);\n\n  return results[0] || null;\n}\n\n/**\n * Get user by username\n * @param username - Username\n * @returns Public profile or null\n */\nexport async function getUserByUsername(username: string): Promise<PublicProfile | null> {\n  const results = await db\n    .select({\n      id: profiles.id,\n      username: profiles.username,\n      bio: profiles.bio,\n      avatarUrl: profiles.avatarUrl,\n      createdAt: profiles.createdAt,\n    })\n    .from(profiles)\n    .where(eq(profiles.username, username))\n    .limit(1);\n\n  return results[0] || null;\n}\n\n/**\n * Update user profile\n * @param userId - User ID\n * @param data - Profile data to update (bio and/or avatarUrl)\n * @returns Updated profile or null if user not found\n */\nexport async function updateProfile(\n  userId: string,\n  data: { bio?: string; avatarUrl?: string }\n): Promise<PublicProfile | null> {\n  // Build update object with only provided fields\n  const updateData: Partial<typeof profiles.$inferInsert> = {};\n  if (data.bio !== undefined) {\n    updateData.bio = data.bio;\n  }\n  if (data.avatarUrl !== undefined) {\n    updateData.avatarUrl = data.avatarUrl;\n  }\n\n  if (Object.keys(updateData).length === 0) {\n    // No updates provided, return current profile\n    return getUserById(userId);\n  }\n\n  const results = await db\n    .update(profiles)\n    .set(updateData)\n    .where(eq(profiles.id, userId))\n    .returning({\n      id: profiles.id,\n      username: profiles.username,\n      bio: profiles.bio,\n      avatarUrl: profiles.avatarUrl,\n      createdAt: profiles.createdAt,\n    });\n\n  return results[0] || null;\n}\n\n/**\n * Check if username exists\n * @param username - Username to check\n * @returns true if exists, false otherwise\n */\nexport async function usernameExists(username: string): Promise<boolean> {\n  const results = await db\n    .select({ id: profiles.id })\n    .from(profiles)\n    .where(eq(profiles.username, username))\n    .limit(1);\n\n  return results.length > 0;\n}\n","import { z } from 'zod';\n\nexport const updateProfileSchema = z.object({\n  bio: z.string().max(160, 'Bio cannot exceed 160 characters').optional(),\n  avatarUrl: z.string().url('Must be a valid URL').optional().or(z.literal('')),\n});\n\nexport type UpdateProfileData = z.infer<typeof updateProfileSchema>;\n","import { v2 as cloudinary } from 'cloudinary';\n\n// Configure Cloudinary\ncloudinary.config({\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n  api_key: process.env.CLOUDINARY_API_KEY,\n  api_secret: process.env.CLOUDINARY_API_SECRET,\n});\n\n/**\n * Upload a file to Cloudinary\n * @param file - File buffer or data URL\n * @param folder - Cloudinary folder (default: 'avatars')\n * @returns Cloudinary URL\n */\nexport async function uploadToCloudinary(\n  file: Buffer | string,\n  folder = 'avatars'\n): Promise<string> {\n  try {\n    // Convert Buffer to base64 data URL if needed\n    let dataUrl: string;\n    if (Buffer.isBuffer(file)) {\n      const base64 = file.toString('base64');\n      dataUrl = `data:image/jpeg;base64,${base64}`;\n    } else {\n      dataUrl = file;\n    }\n\n    // Upload to Cloudinary\n    const result = await cloudinary.uploader.upload(dataUrl, {\n      folder,\n      transformation: [\n        { width: 400, height: 400, crop: 'fill', gravity: 'face' },\n        { quality: 'auto', fetch_format: 'auto' },\n      ],\n    });\n\n    return result.secure_url;\n  } catch (error) {\n    console.error('Cloudinary upload error:', error);\n    throw new Error('Failed to upload image');\n  }\n}\n\n/**\n * Delete an image from Cloudinary\n * @param publicId - Cloudinary public ID\n */\nexport async function deleteFromCloudinary(publicId: string): Promise<void> {\n  try {\n    await cloudinary.uploader.destroy(publicId);\n  } catch (error) {\n    console.error('Cloudinary delete error:', error);\n    // Don't throw - deletion failure shouldn't block the operation\n  }\n}\n\n/**\n * Extract public ID from Cloudinary URL\n * @param url - Cloudinary URL\n * @returns Public ID or null\n */\nexport function extractPublicId(url: string): string | null {\n  try {\n    const match = url.match(/\\/v\\d+\\/(.+)\\.\\w+$/);\n    return match ? match[1] : null;\n  } catch {\n    return null;\n  }\n}\n","\nimport { getUserById, getUserByUsername, updateProfile } from '~/models/user/user.model';\nimport { updateProfileSchema } from '~/models/user/user.schema';\nimport { requireAuth } from '~/lib/auth/session';\nimport { uploadToCloudinary } from '~/lib/upload/cloudinary';\n\n/**\n * Handle get profile by username\n * GET /api/profile/:username\n */\nexport async function handleGetProfile(\n  request: Request,\n  username: string\n): Promise<Response> {\n  try {\n    const profile = await getUserByUsername(username);\n\n    if (!profile) {\n      return Response.json({ error: 'User not found' }, { status: 404 });\n    }\n\n    return Response.json({ profile });\n  } catch (error) {\n    return Response.json({ error: 'Failed to fetch profile' }, { status: 500 });\n  }\n}\n\n/**\n * Handle update own profile\n * PATCH /api/profile\n */\nexport async function handleUpdateProfile(request: Request): Promise<Response> {\n  try {\n    // Require authentication\n    const userId = await requireAuth(request);\n\n    // Parse request body\n    const body = await request.json();\n\n    // Validate data\n    const validated = updateProfileSchema.parse(body);\n\n    // Update profile\n    const updatedProfile = await updateProfile(userId, validated);\n\n    if (!updatedProfile) {\n      return Response.json({ error: 'Profile not found' }, { status: 404 });\n    }\n\n    return Response.json({ profile: updatedProfile });\n  } catch (error) {\n    if (error instanceof Error) {\n      return Response.json({ error: error.message }, { status: 400 });\n    }\n    return Response.json({ error: 'Failed to update profile' }, { status: 500 });\n  }\n}\n\n/**\n * Handle get own profile\n * GET /api/profile/me\n */\nexport async function handleGetOwnProfile(request: Request): Promise<Response> {\n  try {\n    // Require authentication\n    const userId = await requireAuth(request);\n\n    const profile = await getUserById(userId);\n\n    if (!profile) {\n      return Response.json({ error: 'Profile not found' }, { status: 404 });\n    }\n\n    return Response.json({ profile });\n  } catch (error) {\n    return Response.json({ error: 'Failed to fetch profile' }, { status: 500 });\n  }\n}\n\n/**\n * Handle avatar upload\n * POST /api/profile/avatar\n */\nexport async function handleUploadAvatar(request: Request): Promise<Response> {\n  console.log('[handleUploadAvatar] Called');\n  try {\n    // Require authentication\n    const userId = await requireAuth(request);\n    console.log('[handleUploadAvatar] User authenticated:', userId);\n\n    // Parse form data\n    const formData = await request.formData();\n    const file = formData.get('avatar') as File;\n    console.log('[handleUploadAvatar] File received:', file ? 'yes' : 'no');\n\n    if (!file) {\n      console.log('[handleUploadAvatar] No file, returning error');\n      return Response.json({ error: 'No file provided' }, { status: 200 });\n    }\n\n    // Validate file size (5MB max)\n    const MAX_SIZE = 5 * 1024 * 1024; // 5MB\n    if (file.size > MAX_SIZE) {\n      return Response.json({ error: 'File size exceeds 5MB limit' }, { status: 200 });\n    }\n\n    // Validate file type\n    const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];\n    if (!validTypes.includes(file.type)) {\n      return Response.json(\n        { error: 'Invalid file type. Only JPEG, PNG, and WebP are allowed' },\n        { status: 200 }\n      );\n    }\n\n    // Convert file to buffer\n    const arrayBuffer = await file.arrayBuffer();\n    const buffer = Buffer.from(arrayBuffer);\n\n    // Upload to Cloudinary\n    const avatarUrl = await uploadToCloudinary(buffer, 'avatars');\n\n    // Update profile with new avatar URL\n    const updatedProfile = await updateProfile(userId, { avatarUrl });\n\n    if (!updatedProfile) {\n      return Response.json({ error: 'Failed to update profile' }, { status: 500 });\n    }\n\n    return Response.json({\n      success: true,\n      avatarUrl,\n      profile: updatedProfile,\n    });\n  } catch (error) {\n    if (error instanceof Error) {\n      return Response.json({ error: error.message }, { status: 200 });\n    }\n    return Response.json({ error: 'Failed to upload avatar' }, { status: 200 });\n  }\n}\n","import * as authHandlers from './handlers/auth.handler';\nimport * as tweetHandlers from './handlers/tweet.handler';\nimport * as likeHandlers from './handlers/like.handler';\nimport * as profileHandlers from './handlers/profile.handler';\n\nexport interface ApiRoute {\n  method: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE';\n  path: string;\n  handler: (request: Request, ...params: string[]) => Promise<Response>;\n}\n\nexport const apiRoutes: ApiRoute[] = [\n  // Auth routes\n  { method: 'POST', path: '/api/auth/signup', handler: authHandlers.handleSignup },\n  { method: 'POST', path: '/api/auth/login', handler: authHandlers.handleLogin },\n  { method: 'POST', path: '/api/auth/logout', handler: authHandlers.handleLogout },\n  { method: 'GET', path: '/api/auth/verify-email', handler: authHandlers.handleVerifyEmail },\n\n  // Tweet routes\n  { method: 'POST', path: '/api/tweets', handler: tweetHandlers.handleCreateTweet },\n  { method: 'GET', path: '/api/tweets', handler: tweetHandlers.handleGetFeed },\n  { method: 'GET', path: '/api/tweets/user/:userId', handler: tweetHandlers.handleGetUserTweets },\n  { method: 'DELETE', path: '/api/tweets/:tweetId', handler: tweetHandlers.handleDeleteTweet },\n\n  // Like routes\n  { method: 'POST', path: '/api/likes/:tweetId', handler: likeHandlers.handleToggleLike },\n  { method: 'GET', path: '/api/likes/:tweetId', handler: likeHandlers.handleGetLikeStatus },\n\n  // Profile routes\n  { method: 'GET', path: '/api/profile/me', handler: profileHandlers.handleGetOwnProfile },\n  { method: 'GET', path: '/api/profile/:username', handler: profileHandlers.handleGetProfile },\n  { method: 'PATCH', path: '/api/profile', handler: profileHandlers.handleUpdateProfile },\n  { method: 'POST', path: '/api/profile/avatar', handler: profileHandlers.handleUploadAvatar },\n];\n\n/**\n * Match a request path against a route pattern\n * @param pattern - Route pattern (e.g., \"/api/tweets/:id\")\n * @param path - Request path (e.g., \"/api/tweets/123\")\n * @returns Parameters if match, null otherwise\n */\nfunction matchRoute(pattern: string, path: string): string[] | null {\n  const patternParts = pattern.split('/');\n  const pathParts = path.split('/');\n\n  if (patternParts.length !== pathParts.length) {\n    return null;\n  }\n\n  const params: string[] = [];\n\n  for (let i = 0; i < patternParts.length; i++) {\n    const patternPart = patternParts[i];\n    const pathPart = pathParts[i];\n\n    if (patternPart.startsWith(':')) {\n      // Dynamic parameter\n      params.push(pathPart);\n    } else if (patternPart !== pathPart) {\n      // Static part doesn't match\n      return null;\n    }\n  }\n\n  return params;\n}\n\n/**\n * Find matching route and handler for a request\n * @param method - HTTP method\n * @param path - Request path\n * @returns Matched route with params, or null\n */\nexport function findRoute(\n  method: string,\n  path: string\n): { route: ApiRoute; params: string[] } | null {\n  for (const route of apiRoutes) {\n    if (route.method === method) {\n      const params = matchRoute(route.path, path);\n      if (params !== null) {\n        return { route, params };\n      }\n    }\n  }\n\n  return null;\n}\n","import { type LoaderFunctionArgs, type ActionFunctionArgs } from 'react-router';\nimport { findRoute } from '~/api/router';\n\n/**\n * API catch-all route - handles all /api/* requests\n * This is a programmatic API router that dispatches requests to handlers\n */\n\nexport async function loader({ request, params }: LoaderFunctionArgs) {\n  const url = new URL(request.url);\n  const path = url.pathname;\n\n  // Find matching route\n  const match = findRoute('GET', path);\n\n  if (!match) {\n    return Response.json({ error: 'Not found' }, { status: 404 });\n  }\n\n  try {\n    // Call handler with request and extracted params\n    return await match.route.handler(request, ...match.params);\n  } catch (error) {\n    // If error is already a Response (e.g., redirect from requireAuth), return it\n    if (error instanceof Response) {\n      return error;\n    }\n\n    console.error('API Error:', error);\n    return Response.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function action({ request, params }: ActionFunctionArgs) {\n  const url = new URL(request.url);\n  const path = url.pathname;\n  const method = request.method;\n\n  console.log('[API Router] Action called:', method, path);\n\n  // Find matching route\n  const match = findRoute(method, path);\n\n  if (!match) {\n    console.log('[API Router] No route match found');\n    return Response.json({ error: 'Not found' }, { status: 404 });\n  }\n\n  console.log('[API Router] Route matched, calling handler');\n\n  try {\n    // Call handler with request and extracted params\n    const response = await match.route.handler(request, ...match.params);\n    console.log('[API Router] Handler returned response:', response.status, response.headers.get('content-type'));\n    return response;\n  } catch (error) {\n    // If error is already a Response (e.g., redirect from requireAuth), return it\n    if (error instanceof Response) {\n      console.log('[API Router] Caught Response error:', error.status);\n      return error;\n    }\n\n    console.error('API Error:', error);\n    return Response.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n","import { Outlet, useLoaderData } from 'react-router';\nimport { requireAuth } from '~/lib/auth/session';\nimport { getUserById } from '~/models/user/user.model';\nimport type { Route } from './+types/_layout';\n\nexport async function loader({ request }: Route.LoaderArgs) {\n  const userId = await requireAuth(request);\n\n  // Get user profile for header\n  const user = await getUserById(userId);\n\n  return { user };\n}\n\nexport default function ProtectedLayout() {\n  const { user } = useLoaderData<typeof loader>();\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white shadow-sm\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4\">\n          <div className=\"flex justify-between items-center\">\n            <div className=\"flex items-center space-x-4\">\n              <a href=\"/home\" className=\"text-2xl font-bold text-blue-600\">\n                Tweeter\n              </a>\n            </div>\n\n            <div className=\"flex items-center space-x-4\">\n              <a\n                href={`/${user?.username}`}\n                className=\"flex items-center space-x-2 text-gray-700 hover:text-blue-600\"\n              >\n                {user?.avatarUrl ? (\n                  <img\n                    src={user.avatarUrl}\n                    alt={user.username}\n                    className=\"w-8 h-8 rounded-full\"\n                  />\n                ) : (\n                  <div className=\"w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white font-semibold\">\n                    {user?.username.charAt(0).toUpperCase()}\n                  </div>\n                )}\n                <span className=\"text-sm font-medium\">{user?.username}</span>\n              </a>\n\n              <form action=\"/api/auth/logout\" method=\"post\">\n                <button\n                  type=\"submit\"\n                  className=\"text-gray-700 hover:text-red-600 px-3 py-2 rounded-md text-sm font-medium\"\n                >\n                  Logout\n                </button>\n              </form>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Main content */}\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <Outlet />\n      </main>\n\n      {/* Footer */}\n      <footer className=\"bg-white border-t mt-12\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n          <p className=\"text-center text-sm text-gray-500\">\n            &copy; 2026 Tweeter. All rights reserved.\n          </p>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\n\ninterface LikeButtonProps {\n  tweetId: string;\n  initialLiked?: boolean;\n  initialLikeCount?: number;\n  onLike?: (tweetId: string, liked: boolean) => void;\n}\n\nexport function LikeButton({\n  tweetId,\n  initialLiked = false,\n  initialLikeCount = 0,\n  onLike,\n}: LikeButtonProps) {\n  const [liked, setLiked] = useState(initialLiked);\n  const [likeCount, setLikeCount] = useState(initialLikeCount);\n  const [isLoading, setIsLoading] = useState(false);\n\n  // Update local state when props change\n  useEffect(() => {\n    setLiked(initialLiked);\n    setLikeCount(initialLikeCount);\n  }, [initialLiked, initialLikeCount]);\n\n  const handleClick = async () => {\n    if (isLoading) return;\n\n    // Optimistic update\n    const previousLiked = liked;\n    const previousCount = likeCount;\n    const newLiked = !liked;\n\n    setLiked(newLiked);\n    setLikeCount(newLiked ? likeCount + 1 : Math.max(0, likeCount - 1));\n    setIsLoading(true);\n\n    try {\n      // Call the parent handler if provided\n      if (onLike) {\n        onLike(tweetId, newLiked);\n      }\n\n      // The parent component should handle the actual API call\n      // This component just provides optimistic UI\n    } catch (error) {\n      // Revert on error\n      setLiked(previousLiked);\n      setLikeCount(previousCount);\n      console.error('Failed to toggle like:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <button\n      onClick={handleClick}\n      disabled={isLoading}\n      className={`flex items-center space-x-1 transition ${\n        liked\n          ? 'text-red-600 hover:text-red-700'\n          : 'text-gray-500 hover:text-red-600'\n      } ${isLoading ? 'opacity-50 cursor-wait' : ''}`}\n    >\n      <span className=\"text-lg\">{liked ? '‚ù§Ô∏è' : 'ü§ç'}</span>\n      <span className=\"text-sm font-medium\">{likeCount}</span>\n    </button>\n  );\n}\n","import { formatDistanceToNow } from 'date-fns';\nimport { LikeButton } from '~/components/social/LikeButton';\nimport type { TweetWithAuthor } from '~/models/tweet/tweet.model';\n\ninterface TweetFeedItemProps {\n  tweet: TweetWithAuthor;\n  currentUserId?: string;\n  onDelete?: (tweetId: string) => void;\n  onLike?: (tweetId: string, liked: boolean) => void;\n  showLikeButton?: boolean;\n  showDeleteButton?: boolean;\n}\n\nexport function TweetFeedItem({\n  tweet,\n  currentUserId,\n  onDelete,\n  onLike,\n  showLikeButton = true,\n  showDeleteButton = true,\n}: TweetFeedItemProps) {\n  const formatTimestamp = (date: Date | string) => {\n    return formatDistanceToNow(new Date(date), { addSuffix: true });\n  };\n\n  const isOwnTweet = currentUserId === tweet.profileId;\n\n  return (\n    <div className=\"bg-white rounded-lg shadow-sm p-6\">\n      <div className=\"flex items-start space-x-3\">\n        <a href={`/${tweet.author.username}`}>\n          {tweet.author.avatarUrl ? (\n            <img\n              src={tweet.author.avatarUrl}\n              alt={tweet.author.username}\n              className=\"w-12 h-12 rounded-full\"\n            />\n          ) : (\n            <div className=\"w-12 h-12 rounded-full bg-blue-600 flex items-center justify-center text-white font-semibold text-lg\">\n              {tweet.author.username.charAt(0).toUpperCase()}\n            </div>\n          )}\n        </a>\n\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center space-x-2 mb-1\">\n            <a\n              href={`/${tweet.author.username}`}\n              className=\"font-semibold text-gray-900 hover:text-blue-600\"\n            >\n              {tweet.author.username}\n            </a>\n            <span className=\"text-gray-500 text-sm\">\n              {formatTimestamp(tweet.createdAt)}\n            </span>\n          </div>\n\n          <p className=\"text-gray-900 whitespace-pre-wrap break-words\">\n            {tweet.content}\n          </p>\n\n          <div className=\"mt-3 flex items-center space-x-4 text-gray-500\">\n            {showLikeButton && (\n              <LikeButton\n                tweetId={tweet.id}\n                initialLiked={tweet.isLiked ?? false}\n                initialLikeCount={tweet.likeCount ?? 0}\n                onLike={onLike}\n              />\n            )}\n\n            {showDeleteButton && isOwnTweet && onDelete && (\n              <button\n                onClick={() => {\n                  if (confirm('Are you sure you want to delete this tweet?')) {\n                    onDelete(tweet.id);\n                  }\n                }}\n                className=\"hover:text-red-600 transition\"\n              >\n                üóëÔ∏è Delete\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { TweetFeedItem } from './TweetFeedItem';\nimport type { TweetWithAuthor } from '~/models/tweet/tweet.model';\n\ninterface TweetFeedProps {\n  tweets: TweetWithAuthor[];\n  currentUserId?: string;\n  onDelete?: (tweetId: string) => void;\n  onLike?: (tweetId: string, liked: boolean) => void;\n  showLoadMore?: boolean;\n  onLoadMore?: () => void;\n}\n\nexport function TweetFeed({\n  tweets,\n  currentUserId,\n  onDelete,\n  onLike,\n  showLoadMore = false,\n  onLoadMore,\n}: TweetFeedProps) {\n  if (tweets.length === 0) {\n    return (\n      <div className=\"bg-white rounded-lg shadow-sm p-8 text-center\">\n        <p className=\"text-gray-500 mb-4\">No tweets yet. Be the first to post!</p>\n        <a\n          href=\"/compose\"\n          className=\"inline-block px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700\"\n        >\n          Compose Your First Tweet\n        </a>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {tweets.map((tweet) => (\n        <TweetFeedItem\n          key={tweet.id}\n          tweet={tweet}\n          currentUserId={currentUserId}\n          onDelete={onDelete}\n          onLike={onLike}\n        />\n      ))}\n\n      {showLoadMore && onLoadMore && (\n        <div className=\"text-center pt-4\">\n          <button\n            onClick={onLoadMore}\n            className=\"px-6 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 font-medium\"\n          >\n            Load More\n          </button>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { Form, useActionData } from 'react-router';\n\ninterface TweetComposerProps {\n  onCancel?: () => void;\n  showCancelButton?: boolean;\n  redirectOnSuccess?: boolean;\n}\n\nexport function TweetComposer({\n  onCancel,\n  showCancelButton = false,\n  redirectOnSuccess = true,\n}: TweetComposerProps) {\n  const actionData = useActionData<{ success?: boolean; error?: string }>();\n  const [content, setContent] = useState('');\n\n  // Clear form on successful submission\n  useEffect(() => {\n    if (actionData?.success) {\n      setContent('');\n    }\n  }, [actionData]);\n\n  const remainingChars = 140 - content.length;\n  const isValid = content.length > 0 && content.length <= 140;\n  const isOverLimit = remainingChars < 0;\n  const isNearLimit = remainingChars < 20 && remainingChars >= 0;\n\n  return (\n    <div className=\"bg-white rounded-lg shadow-sm p-6\">\n      <Form method=\"post\" className=\"space-y-4\" autoComplete=\"off\">\n        <input type=\"hidden\" name=\"intent\" value=\"compose\" />\n        <div>\n          <textarea\n            name=\"content\"\n            value={content}\n            onChange={(e) => setContent(e.target.value)}\n            placeholder=\"What's happening?\"\n            autoComplete=\"off\"\n            className={`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none ${\n              isOverLimit ? 'border-red-500' : 'border-gray-300'\n            }`}\n            rows={4}\n            maxLength={200}\n          />\n          <div className=\"flex justify-between items-center mt-2\">\n            <span\n              className={`text-sm font-medium ${\n                isOverLimit\n                  ? 'text-red-600'\n                  : isNearLimit\n                    ? 'text-yellow-600'\n                    : 'text-gray-500'\n              }`}\n            >\n              {remainingChars} characters remaining\n            </span>\n            {isOverLimit && (\n              <span className=\"text-xs text-red-600\">\n                Your tweet is too long!\n              </span>\n            )}\n          </div>\n        </div>\n\n        {actionData?.error && (\n          <div className=\"p-3 bg-red-50 border border-red-200 rounded-lg\">\n            <p className=\"text-red-600 text-sm\">{actionData.error}</p>\n          </div>\n        )}\n\n        <div className=\"flex gap-3\">\n          <button\n            type=\"submit\"\n            disabled={!isValid}\n            className=\"flex-1 px-6 py-2.5 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition\"\n          >\n            Tweet\n          </button>\n          {showCancelButton && onCancel && (\n            <button\n              type=\"button\"\n              onClick={onCancel}\n              className=\"px-6 py-2.5 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition\"\n            >\n              Cancel\n            </button>\n          )}\n        </div>\n      </Form>\n    </div>\n  );\n}\n","import { useLoaderData, useRevalidator } from 'react-router';\nimport { requireAuth, getUserId } from '~/lib/auth/session';\nimport { getFeed, createTweet, deleteTweet } from '~/models/tweet/tweet.model';\nimport { getLikeCount, isLikedByUser, toggleLike } from '~/models/like/like.model';\nimport { TweetFeed } from '~/components/tweet/TweetFeed';\nimport { TweetComposer } from '~/components/tweet/TweetComposer';\nimport type { Route } from './+types/home';\n\nexport async function loader({ request }: Route.LoaderArgs) {\n  await requireAuth(request);\n  const userId = await getUserId(request);\n  const tweets = await getFeed(20, 0);\n\n  // Enrich tweets with like information\n  const enrichedTweets = await Promise.all(\n    tweets.map(async (tweet) => {\n      const likeCount = await getLikeCount(tweet.id);\n      const isLiked = userId ? await isLikedByUser(tweet.id, userId) : false;\n      return {\n        ...tweet,\n        likeCount,\n        isLiked,\n      };\n    })\n  );\n\n  return { tweets: enrichedTweets, userId };\n}\n\nexport async function action({ request }: Route.ActionArgs) {\n  const userId = await requireAuth(request);\n  const formData = await request.formData();\n  const tweetId = formData.get('tweetId') as string;\n  const intent = formData.get('intent') as string;\n\n  // Handle tweet composition\n  if (intent === 'compose') {\n    const content = formData.get('content') as string;\n\n    try {\n      await createTweet(userId, { content });\n      return { success: true };\n    } catch (error) {\n      return { error: error instanceof Error ? error.message : 'Failed to create tweet' };\n    }\n  }\n\n  // Handle tweet deletion\n  if (intent === 'delete' && tweetId) {\n    try {\n      const deleted = await deleteTweet(tweetId, userId);\n      if (!deleted) {\n        return { error: 'Failed to delete tweet' };\n      }\n      return { success: true };\n    } catch (error) {\n      return { error: error instanceof Error ? error.message : 'Failed to delete tweet' };\n    }\n  }\n\n  // Handle tweet like/unlike\n  if (intent === 'like' && tweetId) {\n    try {\n      await toggleLike(tweetId, userId);\n      return { success: true };\n    } catch (error) {\n      return { error: error instanceof Error ? error.message : 'Failed to toggle like' };\n    }\n  }\n\n  return null;\n}\n\nexport default function HomePage() {\n  const { tweets, userId } = useLoaderData<typeof loader>();\n  const revalidator = useRevalidator();\n\n  const handleLoadMore = () => {\n    revalidator.revalidate();\n  };\n\n  const handleDelete = async (tweetId: string) => {\n    const formData = new FormData();\n    formData.append('tweetId', tweetId);\n    formData.append('intent', 'delete');\n\n    const response = await fetch('/home', {\n      method: 'POST',\n      body: formData,\n    });\n\n    if (response.ok) {\n      revalidator.revalidate();\n    }\n  };\n\n  const handleLike = async (tweetId: string, liked: boolean) => {\n    const formData = new FormData();\n    formData.append('tweetId', tweetId);\n    formData.append('intent', 'like');\n\n    const response = await fetch('/home', {\n      method: 'POST',\n      body: formData,\n    });\n\n    if (response.ok) {\n      // Revalidate to ensure data consistency\n      revalidator.revalidate();\n    }\n  };\n\n  return (\n    <div className=\"max-w-2xl mx-auto\">\n      {/* Inline Tweet Composer */}\n      <div className=\"mb-6\">\n        <TweetComposer\n          showCancelButton={false}\n          redirectOnSuccess={false}\n        />\n      </div>\n\n      {/* Tweet Feed */}\n      <TweetFeed\n        tweets={tweets}\n        currentUserId={userId ?? undefined}\n        onDelete={handleDelete}\n        onLike={handleLike}\n        showLoadMore={tweets.length >= 20}\n        onLoadMore={handleLoadMore}\n      />\n    </div>\n  );\n}\n","import { useNavigate } from 'react-router';\nimport { redirect } from 'react-router';\nimport { requireAuth } from '~/lib/auth/session';\nimport { handleCreateTweet } from '~/api/handlers/tweet.handler';\nimport { TweetComposer } from '~/components/tweet/TweetComposer';\nimport type { Route } from './+types/compose';\n\nexport async function loader({ request }: Route.LoaderArgs) {\n  await requireAuth(request);\n  return null;\n}\n\nexport async function action({ request }: Route.ActionArgs) {\n  await requireAuth(request);\n  const result = await handleCreateTweet(request);\n\n  // If successful (status 201), redirect to home\n  if (result.status === 201) {\n    return redirect('/home');\n  }\n\n  return result;\n}\n\nexport default function ComposePage() {\n  const navigate = useNavigate();\n\n  const handleCancel = () => {\n    navigate('/home');\n  };\n\n  return (\n    <div className=\"max-w-2xl mx-auto\">\n      <h1 className=\"text-2xl font-bold text-gray-900 mb-6\">Compose Tweet</h1>\n\n      <TweetComposer\n        showCancelButton={true}\n        onCancel={handleCancel}\n      />\n\n      <div className=\"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg\">\n        <p className=\"text-sm text-blue-800\">\n          <strong>Tip:</strong> Keep your tweets concise and engaging. You have 140 characters max!\n        </p>\n      </div>\n    </div>\n  );\n}\n","import { useState, useRef } from 'react';\n\ninterface AvatarUploadProps {\n  currentAvatarUrl?: string | null;\n  username: string;\n  onUploadComplete?: (avatarUrl: string) => void;\n}\n\nexport function AvatarUpload({\n  currentAvatarUrl,\n  username,\n  onUploadComplete,\n}: AvatarUploadProps) {\n  const [previewUrl, setPreviewUrl] = useState<string | null>(currentAvatarUrl || null);\n  const [isUploading, setIsUploading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    // Validate file size (5MB)\n    const MAX_SIZE = 5 * 1024 * 1024;\n    if (file.size > MAX_SIZE) {\n      setError('File size exceeds 5MB limit');\n      return;\n    }\n\n    // Validate file type\n    const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];\n    if (!validTypes.includes(file.type)) {\n      setError('Invalid file type. Only JPEG, PNG, and WebP are allowed');\n      return;\n    }\n\n    // Clear error\n    setError(null);\n\n    // Create preview\n    const reader = new FileReader();\n    reader.onloadend = () => {\n      setPreviewUrl(reader.result as string);\n    };\n    reader.readAsDataURL(file);\n\n    // Upload file\n    handleUpload(file);\n  };\n\n  const handleUpload = async (file: File) => {\n    setIsUploading(true);\n    setError(null);\n\n    try {\n      const formData = new FormData();\n      formData.append('avatar', file);\n\n      const response = await fetch('/api/profile/avatar', {\n        method: 'POST',\n        body: formData,\n      });\n\n      // Check if response is a redirect (user not authenticated)\n      if (response.redirected || response.type === 'opaqueredirect') {\n        throw new Error('Please log in to upload avatar');\n      }\n\n      // Try to parse response as JSON\n      let data;\n      try {\n        data = await response.json();\n      } catch (jsonError) {\n        // If JSON parsing fails, it might be an HTML error page\n        throw new Error('Unexpected response format. Please try again.');\n      }\n\n      if (!response.ok) {\n        throw new Error(data.error || 'Upload failed');\n      }\n\n      setPreviewUrl(data.avatarUrl);\n      if (onUploadComplete) {\n        onUploadComplete(data.avatarUrl);\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Upload failed');\n      setPreviewUrl(currentAvatarUrl || null);\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const handleClick = () => {\n    fileInputRef.current?.click();\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center space-x-4\">\n        {/* Avatar Preview */}\n        <div className=\"relative\">\n          {previewUrl ? (\n            <img\n              src={previewUrl}\n              alt=\"Avatar\"\n              className=\"w-24 h-24 rounded-full object-cover\"\n            />\n          ) : (\n            <div className=\"w-24 h-24 rounded-full bg-blue-600 flex items-center justify-center text-white font-semibold text-3xl\">\n              {username.charAt(0).toUpperCase()}\n            </div>\n          )}\n\n          {isUploading && (\n            <div className=\"absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center\">\n              <div className=\"text-white text-sm\">Uploading...</div>\n            </div>\n          )}\n        </div>\n\n        {/* Upload Button */}\n        <div>\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            accept=\"image/jpeg,image/jpg,image/png,image/webp\"\n            onChange={handleFileSelect}\n            className=\"hidden\"\n          />\n          <button\n            type=\"button\"\n            onClick={handleClick}\n            disabled={isUploading}\n            className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed font-medium\"\n          >\n            {isUploading ? 'Uploading...' : 'Change Avatar'}\n          </button>\n          <p className=\"mt-2 text-sm text-gray-500\">\n            JPEG, PNG, or WebP. Max 5MB.\n          </p>\n        </div>\n      </div>\n\n      {/* Error Message */}\n      {error && (\n        <div className=\"p-3 bg-red-50 border border-red-200 rounded-lg\">\n          <p className=\"text-red-600 text-sm\">{error}</p>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState } from 'react';\nimport { useLoaderData, useActionData, Form, useNavigate, useRevalidator } from 'react-router';\nimport { requireAuth } from '~/lib/auth/session';\nimport { getUserById, updateProfile } from '~/models/user/user.model';\nimport { updateProfileSchema } from '~/models/user/user.schema';\nimport { AvatarUpload } from '~/components/profile/AvatarUpload';\nimport type { Route } from './+types/settings';\n\nexport async function loader({ request }: Route.LoaderArgs) {\n  const userId = await requireAuth(request);\n  const profile = await getUserById(userId);\n\n  if (!profile) {\n    throw new Response('Profile not found', { status: 404 });\n  }\n\n  return { profile };\n}\n\nexport async function action({ request }: Route.ActionArgs) {\n  try {\n    const userId = await requireAuth(request);\n    const formData = await request.formData();\n\n    const bio = formData.get('bio') as string;\n\n    // Validate (only bio field - avatarUrl is handled separately by AvatarUpload component)\n    const validated = updateProfileSchema.parse({ bio });\n\n    // Update profile\n    const updatedProfile = await updateProfile(userId, validated);\n\n    if (!updatedProfile) {\n      return { error: 'Failed to update profile' };\n    }\n\n    return { success: true, profile: updatedProfile };\n  } catch (error) {\n    if (error instanceof Error) {\n      return { error: error.message };\n    }\n    return { error: 'Failed to update profile' };\n  }\n}\n\nexport default function SettingsPage() {\n  const { profile } = useLoaderData<typeof loader>();\n  const actionData = useActionData<typeof action>();\n  const navigate = useNavigate();\n  const revalidator = useRevalidator();\n\n  const [bio, setBio] = useState(profile.bio || '');\n\n  const bioLength = bio.length;\n  const bioRemaining = 160 - bioLength;\n  const isBioValid = bioLength <= 160;\n\n  return (\n    <div className=\"max-w-2xl mx-auto\">\n      <div className=\"bg-white rounded-lg shadow-sm p-6\">\n        <h1 className=\"text-2xl font-bold text-gray-900 mb-6\">Profile Settings</h1>\n\n        {/* Avatar Upload Section (outside form) */}\n        <div className=\"mb-6\">\n          <label className=\"block text-sm font-medium text-gray-700 mb-4\">\n            Profile Picture\n          </label>\n          <AvatarUpload\n            currentAvatarUrl={profile.avatarUrl}\n            username={profile.username}\n            onUploadComplete={() => revalidator.revalidate()}\n          />\n        </div>\n\n        <Form method=\"post\" className=\"space-y-6\">\n\n          {/* Bio */}\n          <div>\n            <label htmlFor=\"bio\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Bio\n            </label>\n            <textarea\n              id=\"bio\"\n              name=\"bio\"\n              value={bio}\n              onChange={(e) => setBio(e.target.value)}\n              placeholder=\"Tell us about yourself...\"\n              className={`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none ${\n                !isBioValid ? 'border-red-500' : 'border-gray-300'\n              }`}\n              rows={4}\n              maxLength={200}\n            />\n            <div className=\"flex justify-between items-center mt-1\">\n              <span className={`text-sm ${bioRemaining < 0 ? 'text-red-600' : 'text-gray-500'}`}>\n                {bioRemaining} characters remaining\n              </span>\n            </div>\n          </div>\n\n          {/* Success/Error Messages */}\n          {actionData && 'success' in actionData && actionData.success && (\n            <div className=\"p-4 bg-green-50 border border-green-200 rounded-lg\">\n              <p className=\"text-green-600 text-sm\">Profile updated successfully!</p>\n            </div>\n          )}\n\n          {actionData && 'error' in actionData && (\n            <div className=\"p-4 bg-red-50 border border-red-200 rounded-lg\">\n              <p className=\"text-red-600 text-sm\">{actionData.error}</p>\n            </div>\n          )}\n\n          {/* Action Buttons */}\n          <div className=\"flex gap-3\">\n            <button\n              type=\"submit\"\n              disabled={!isBioValid}\n              className=\"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition\"\n            >\n              Save Changes\n            </button>\n            <button\n              type=\"button\"\n              onClick={() => navigate(`/${profile.username}`)}\n              className=\"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition\"\n            >\n              Cancel\n            </button>\n          </div>\n        </Form>\n      </div>\n    </div>\n  );\n}\n","import { useLoaderData } from 'react-router';\nimport { getUserByUsername } from '~/models/user/user.model';\nimport { getTweetsByUserId } from '~/models/tweet/tweet.model';\nimport { getLikeCount, isLikedByUser } from '~/models/like/like.model';\nimport { getUserId } from '~/lib/auth/session';\nimport { TweetFeed } from '~/components/tweet/TweetFeed';\nimport { formatDistanceToNow } from 'date-fns';\nimport type { Route } from './+types/$username';\n\nexport async function loader({ params, request }: Route.LoaderArgs) {\n  const username = params.username;\n\n  // Get profile\n  const profile = await getUserByUsername(username);\n\n  if (!profile) {\n    throw new Response('User not found', { status: 404 });\n  }\n\n  // Get current user ID (optional)\n  const currentUserId = await getUserId(request).catch(() => null);\n\n  // Get user's tweets\n  const tweets = await getTweetsByUserId(profile.id, 20, 0);\n\n  // Enrich tweets with like information\n  const enrichedTweets = await Promise.all(\n    tweets.map(async (tweet) => {\n      const likeCount = await getLikeCount(tweet.id);\n      const isLiked = currentUserId ? await isLikedByUser(tweet.id, currentUserId) : false;\n      return {\n        ...tweet,\n        likeCount,\n        isLiked,\n      };\n    })\n  );\n\n  const isOwnProfile = currentUserId === profile.id;\n\n  return {\n    profile,\n    tweets: enrichedTweets,\n    isOwnProfile,\n    currentUserId,\n  };\n}\n\nexport default function UserProfilePage() {\n  const { profile, tweets, isOwnProfile, currentUserId } = useLoaderData<typeof loader>();\n\n  const formatJoinDate = (date: Date | string) => {\n    const dateObj = new Date(date);\n    return dateObj.toLocaleDateString('en-US', {\n      month: 'long',\n      year: 'numeric',\n    });\n  };\n\n  return (\n    <div className=\"max-w-2xl mx-auto\">\n      {/* Profile Header */}\n      <div className=\"bg-white rounded-lg shadow-sm p-6 mb-6\">\n        <div className=\"flex items-start space-x-4\">\n          {/* Avatar */}\n          <div>\n            {profile.avatarUrl ? (\n              <img\n                src={profile.avatarUrl}\n                alt={profile.username}\n                className=\"w-24 h-24 rounded-full\"\n              />\n            ) : (\n              <div className=\"w-24 h-24 rounded-full bg-blue-600 flex items-center justify-center text-white font-semibold text-3xl\">\n                {profile.username.charAt(0).toUpperCase()}\n              </div>\n            )}\n          </div>\n\n          {/* Profile Info */}\n          <div className=\"flex-1\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <h1 className=\"text-2xl font-bold text-gray-900\">{profile.username}</h1>\n              {isOwnProfile && (\n                <a\n                  href=\"/settings\"\n                  className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium text-sm\"\n                >\n                  Edit Profile\n                </a>\n              )}\n            </div>\n\n            {profile.bio && (\n              <p className=\"text-gray-700 mb-3 whitespace-pre-wrap\">{profile.bio}</p>\n            )}\n\n            <p className=\"text-gray-500 text-sm\">\n              Joined {formatJoinDate(profile.createdAt)}\n            </p>\n          </div>\n        </div>\n      </div>\n\n      {/* Tweets Section */}\n      <div className=\"mb-4\">\n        <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">\n          Tweets ({tweets.length})\n        </h2>\n\n        <TweetFeed\n          tweets={tweets}\n          currentUserId={currentUserId ?? undefined}\n          showLoadMore={false}\n        />\n      </div>\n    </div>\n  );\n}\n"],"names":["streamTimeout","handleRequest","request","responseStatusCode","responseHeaders","routerContext","loadContext","resolve","reject","shellRendered","userAgent","readyOption","isbot","timeoutId","abort","pipe","renderToPipeableStream","ServerRouter","body","PassThrough","callback","stream","createReadableStreamFromReadable","error","Layout","children","jsxs","lang","jsx","charSet","name","content","Meta","Links","className","ScrollRestoration","Scripts","root","_UNSAFE_withComponentProps","Outlet","HydrateFallback","_UNSAFE_withHydrateFallbackProps","sessionStorage","createCookieSessionStorage","createUserSession","userId","redirectTo","session","redirect","getUserId","requireAuth","url","logout","loader","_index","href","profiles","pgTable","uuid","uuidv7","text","boolean","timestamp","tweets","likes","table","primaryKey","cleanDatabaseUrl","sql","postgres","db","drizzle","schema","hashPassword","password","hash","verifyPassword","verify","signupSchema","z","loginSchema","signupUser","data","validated","eq","passwordHash","user","secret","verificationToken","SignJWT","verifyEmail","token","jwtVerify","payload","authenticateUser","email","action","formData","username","get","Error","message","signup","actionData","useActionData","isSubmitting","useNavigation","state","setPassword","useState","confirmPassword","setConfirmPassword","passwordsMatch","length","showPasswordMismatch","isFormValid","handlePasswordChange","e","target","value","handleConfirmPasswordChange","Form","method","htmlFor","id","type","required","minLength","maxLength","pattern","placeholder","onChange","disabled","rateLimitStore","createRateLimiter","options","identifier","now","entry","current","loginRateLimiter","signupRateLimiter","tweetRateLimiter","getClientIp","forwarded","clientIp","allowed","login","navigation","searchParams","useSearchParams","verificationPending","autoComplete","URL","success","loaderData","Fragment","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","Link","to","mailgun","Mailgun","FormData","mg","sendVerificationEmail","baseUrl","verificationUrl","fromEmail","fromName","handleSignup","emailError","handleLogin","handleLogout","handleVerifyEmail","tweetSchema","createTweet","profileId","tweet","getFeed","limit","offset","desc","getTweetsByUserId","deleteTweet","tweetId","handleCreateTweet","handleGetFeed","handleGetUserTweets","handleDeleteTweet","toggleLike","and","isLikedByUser","getLikeCount","count","handleToggleLike","liked","likeCount","handleGetLikeStatus","getUserById","getUserByUsername","updateProfile","updateData","updateProfileSchema","cloudinary","uploadToCloudinary","file","folder","dataUrl","handleGetProfile","profile","handleUpdateProfile","updatedProfile","handleGetOwnProfile","handleUploadAvatar","MAX_SIZE","arrayBuffer","buffer","avatarUrl","apiRoutes","authHandlers.handleSignup","authHandlers.handleLogin","authHandlers.handleLogout","authHandlers.handleVerifyEmail","tweetHandlers.handleCreateTweet","tweetHandlers.handleGetFeed","tweetHandlers.handleGetUserTweets","tweetHandlers.handleDeleteTweet","likeHandlers.handleToggleLike","likeHandlers.handleGetLikeStatus","profileHandlers.handleGetOwnProfile","profileHandlers.handleGetProfile","profileHandlers.handleUpdateProfile","profileHandlers.handleUploadAvatar","matchRoute","path","patternParts","pathParts","params","i","patternPart","pathPart","findRoute","route","pathname","match","Response","json","status","handler","console","log","response","headers","_layout","useLoaderData","src","alt","charAt","toUpperCase","LikeButton","initialLiked","initialLikeCount","onLike","setLiked","setLikeCount","isLoading","setIsLoading","useEffect","previousLiked","previousCount","newLiked","TweetFeedItem","currentUserId","onDelete","showLikeButton","showDeleteButton","formatTimestamp","date","formatDistanceToNow","isOwnTweet","TweetFeed","showLoadMore","onLoadMore","TweetComposer","onCancel","showCancelButton","redirectOnSuccess","setContent","remainingChars","isValid","isOverLimit","isNearLimit","Promise","all","map","isLiked","intent","home","revalidator","useRevalidator","handleLoadMore","revalidate","append","fetch","ok","result","compose","navigate","useNavigate","handleCancel","AvatarUpload","currentAvatarUrl","onUploadComplete","previewUrl","setPreviewUrl","isUploading","setIsUploading","setError","fileInputRef","useRef","handleFileSelect","event","reader","handleUpload","err","handleClick","bio","parse","settings","setBio","bioLength","bioRemaining","isBioValid","rows","onClick","catch","enrichedTweets","isOwnProfile","$username","formatJoinDate","Date","toLocaleDateString","month","year","createdAt"],"mappings":"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","x_google_ignoreList":[0]}