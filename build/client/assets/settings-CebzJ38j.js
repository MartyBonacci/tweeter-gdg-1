import{r as m,j as e,w as v,c as y,u as N,e as w,d as P,F as U}from"./chunk-EPOLDU6W-Z5o18_rP.js";function E({currentAvatarUrl:p,username:r,onUploadComplete:s}){const[u,i]=m.useState(p||null),[l,x]=m.useState(!1),[o,t]=m.useState(null),d=m.useRef(null),b=h=>{const a=h.target.files?.[0];if(!a)return;const n=5*1024*1024;if(a.size>n){t("File size exceeds 5MB limit");return}if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(a.type)){t("Invalid file type. Only JPEG, PNG, and WebP are allowed");return}t(null);const g=new FileReader;g.onloadend=()=>{i(g.result)},g.readAsDataURL(a),f(a)},f=async h=>{x(!0),t(null);try{const a=new FormData;a.append("avatar",h);const n=await fetch("/api/profile/avatar",{method:"POST",body:a});if(n.redirected||n.type==="opaqueredirect")throw new Error("Please log in to upload avatar");let c;try{c=await n.json()}catch{throw new Error("Unexpected response format. Please try again.")}if(!n.ok)throw new Error(c.error||"Upload failed");i(c.avatarUrl),s&&s(c.avatarUrl)}catch(a){t(a instanceof Error?a.message:"Upload failed"),i(p||null)}finally{x(!1)}},j=()=>{d.current?.click()};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[u?e.jsx("img",{src:u,alt:"Avatar",className:"w-24 h-24 rounded-full object-cover"}):e.jsx("div",{className:"w-24 h-24 rounded-full bg-blue-600 flex items-center justify-center text-white font-semibold text-3xl",children:r.charAt(0).toUpperCase()}),l&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"text-white text-sm",children:"Uploading..."})})]}),e.jsxs("div",{children:[e.jsx("input",{ref:d,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:b,className:"hidden"}),e.jsx("button",{type:"button",onClick:j,disabled:l,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed font-medium",children:l?"Uploading...":"Change Avatar"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"JPEG, PNG, or WebP. Max 5MB."})]})]}),o&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-600 text-sm",children:o})})]})}const S=v(function(){const{profile:r}=y(),s=N(),u=w(),i=P(),[l,x]=m.useState(r.bio||""),o=l.length,t=160-o,d=o<=160;return e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Profile Settings"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-4",children:"Profile Picture"}),e.jsx(E,{currentAvatarUrl:r.avatarUrl,username:r.username,onUploadComplete:()=>i.revalidate()})]}),e.jsxs(U,{method:"post",className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bio",className:"block text-sm font-medium text-gray-700 mb-2",children:"Bio"}),e.jsx("textarea",{id:"bio",name:"bio",value:l,onChange:b=>x(b.target.value),placeholder:"Tell us about yourself...",className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none ${d?"border-gray-300":"border-red-500"}`,rows:4,maxLength:200}),e.jsx("div",{className:"flex justify-between items-center mt-1",children:e.jsxs("span",{className:`text-sm ${t<0?"text-red-600":"text-gray-500"}`,children:[t," characters remaining"]})})]}),s&&"success"in s&&s.success&&e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("p",{className:"text-green-600 text-sm",children:"Profile updated successfully!"})}),s&&"error"in s&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-600 text-sm",children:s.error})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:!d,className:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition",children:"Save Changes"}),e.jsx("button",{type:"button",onClick:()=>u(`/${r.username}`),className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})});export{S as default};
//# sourceMappingURL=settings-CebzJ38j.js.map
