{"version":3,"file":"home-Dbd-gefo.js","sources":["../../../app/routes/home.tsx"],"sourcesContent":["import { useLoaderData, useRevalidator } from 'react-router';\nimport { requireAuth, getUserId } from '~/lib/auth/session';\nimport { getFeed, createTweet, deleteTweet } from '~/models/tweet/tweet.model';\nimport { getLikeCount, isLikedByUser, toggleLike } from '~/models/like/like.model';\nimport { TweetFeed } from '~/components/tweet/TweetFeed';\nimport { TweetComposer } from '~/components/tweet/TweetComposer';\nimport type { Route } from './+types/home';\n\nexport async function loader({ request }: Route.LoaderArgs) {\n  await requireAuth(request);\n  const userId = await getUserId(request);\n  const tweets = await getFeed(20, 0);\n\n  // Enrich tweets with like information\n  const enrichedTweets = await Promise.all(\n    tweets.map(async (tweet) => {\n      const likeCount = await getLikeCount(tweet.id);\n      const isLiked = userId ? await isLikedByUser(tweet.id, userId) : false;\n      return {\n        ...tweet,\n        likeCount,\n        isLiked,\n      };\n    })\n  );\n\n  return { tweets: enrichedTweets, userId };\n}\n\nexport async function action({ request }: Route.ActionArgs) {\n  const userId = await requireAuth(request);\n  const formData = await request.formData();\n  const tweetId = formData.get('tweetId') as string;\n  const intent = formData.get('intent') as string;\n\n  // Handle tweet composition\n  if (intent === 'compose') {\n    const content = formData.get('content') as string;\n\n    try {\n      await createTweet(userId, { content });\n      return { success: true };\n    } catch (error) {\n      return { error: error instanceof Error ? error.message : 'Failed to create tweet' };\n    }\n  }\n\n  // Handle tweet deletion\n  if (intent === 'delete' && tweetId) {\n    try {\n      const deleted = await deleteTweet(tweetId, userId);\n      if (!deleted) {\n        return { error: 'Failed to delete tweet' };\n      }\n      return { success: true };\n    } catch (error) {\n      return { error: error instanceof Error ? error.message : 'Failed to delete tweet' };\n    }\n  }\n\n  // Handle tweet like/unlike\n  if (intent === 'like' && tweetId) {\n    try {\n      await toggleLike(tweetId, userId);\n      return { success: true };\n    } catch (error) {\n      return { error: error instanceof Error ? error.message : 'Failed to toggle like' };\n    }\n  }\n\n  return null;\n}\n\nexport default function HomePage() {\n  const { tweets, userId } = useLoaderData<typeof loader>();\n  const revalidator = useRevalidator();\n\n  const handleLoadMore = () => {\n    revalidator.revalidate();\n  };\n\n  const handleDelete = async (tweetId: string) => {\n    const formData = new FormData();\n    formData.append('tweetId', tweetId);\n    formData.append('intent', 'delete');\n\n    const response = await fetch('/home', {\n      method: 'POST',\n      body: formData,\n    });\n\n    if (response.ok) {\n      revalidator.revalidate();\n    }\n  };\n\n  const handleLike = async (tweetId: string, liked: boolean) => {\n    const formData = new FormData();\n    formData.append('tweetId', tweetId);\n    formData.append('intent', 'like');\n\n    const response = await fetch('/home', {\n      method: 'POST',\n      body: formData,\n    });\n\n    if (response.ok) {\n      // Revalidate to ensure data consistency\n      revalidator.revalidate();\n    }\n  };\n\n  return (\n    <div className=\"max-w-2xl mx-auto\">\n      {/* Inline Tweet Composer */}\n      <div className=\"mb-6\">\n        <TweetComposer\n          showCancelButton={false}\n          redirectOnSuccess={false}\n        />\n      </div>\n\n      {/* Tweet Feed */}\n      <TweetFeed\n        tweets={tweets}\n        currentUserId={userId ?? undefined}\n        onDelete={handleDelete}\n        onLike={handleLike}\n        showLoadMore={tweets.length >= 20}\n        onLoadMore={handleLoadMore}\n      />\n    </div>\n  );\n}\n"],"names":["home","_UNSAFE_withComponentProps","tweets","userId","useLoaderData","revalidator","useRevalidator","handleLoadMore","revalidate","handleDelete","tweetId","formData","FormData","append","fetch","method","body","ok","handleLike","liked","jsxs","className","children","jsx","TweetComposer","showCancelButton","redirectOnSuccess","TweetFeed","currentUserId","onDelete","onLike","showLoadMore","length","onLoadMore"],"mappings":"kKAyEA,MAAAA,EAAAC,EAAA,UAAmC,CACjC,KAAM,CAAEC,OAAAA,EAAQC,OAAAA,GAAWC,EAAA,EACrBC,EAAcC,EAAA,EAEdC,EAAiBA,IAAM,CAC3BF,EAAYG,WAAA,CACd,EAEMC,EAAe,MAAOC,GAAoB,CAC9C,MAAMC,EAAW,IAAIC,SACrBD,EAASE,OAAO,UAAWH,CAAO,EAClCC,EAASE,OAAO,SAAU,QAAQ,GAEjB,MAAMC,MAAM,QAAS,CACpCC,OAAQ,OACRC,KAAML,CACR,CAAC,GAEYM,IACXZ,EAAYG,WAAA,CAEhB,EAEMU,EAAa,MAAOR,EAAiBS,IAAmB,CAC5D,MAAMR,EAAW,IAAIC,SACrBD,EAASE,OAAO,UAAWH,CAAO,EAClCC,EAASE,OAAO,SAAU,MAAM,GAEf,MAAMC,MAAM,QAAS,CACpCC,OAAQ,OACRC,KAAML,CACR,CAAC,GAEYM,IAEXZ,EAAYG,WAAA,CAEhB,EAEA,OACEY,EAAAA,KAAC,MAAA,CAAIC,UAAU,oBAEbC,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAIF,UAAU,OACbC,SAAAC,EAAAA,IAACC,EAAA,CACCC,iBAAkB,GAClBC,kBAAmB,GACrB,CAAA,CACF,EAGAH,EAAAA,IAACI,EAAA,CACCzB,OAAAA,EACA0B,cAAezB,GAAU,OACzB0B,SAAUpB,EACVqB,OAAQZ,EACRa,aAAc7B,EAAO8B,QAAU,GAC/BC,WAAY1B,CAAA,CACd,CAAA,CAAA,CACF,CAEJ,CAAA"}